import{u as Qr,a as dt,j as b,o as m,e as mt,s as d,g as Xr,b as j,n as I,d as Dt,l as T,c as le,f as Sn,h as B,r as De,Z as E,i as tt,k as ea,m as ta,p as na,q as ft,t as V,v as Xe,w as ra,x as In,y as aa,R as sa}from"./index-Cu6C69AO.js";import{i as Se,u as oa,a as ia,R as nt,U as kn,D as la}from"./error-CfQj2i2q.js";const nn=()=>{const e=Qr(),{data:t=[],isLoading:n,isError:r,error:a}=dt({queryKey:["document-samples"],queryFn:async()=>await Se.getDocumentSamples()||[]});return n?b.jsx("div",{className:"p-4 text-foreground",children:"Loading samples..."}):r?b.jsxs("div",{className:"p-4 text-destructive",children:["Error loading samples:"," ",a instanceof Error?a.message:String(a)]}):b.jsxs("div",{className:"p-4",children:[b.jsx("h2",{className:"text-lg font-bold mb-2 text-foreground",children:"Select a Document Sample"}),b.jsx("ul",{children:t.map(s=>b.jsx("li",{className:"mb-2",children:b.jsx("button",{type:"button",className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",onClick:()=>e({to:"/questions",search:{sample:s.id}}),children:s.name})},s.id))}),t.length===0&&b.jsx("div",{className:"text-muted-foreground italic text-center py-4 bg-muted/30 rounded",children:"No samples yet."})]})},ua=m({text:d().min(3,"Question must be at least 3 characters"),type:mt(["answerable","non-answerable"])}),ca=({sampleId:e})=>{const{register:t,handleSubmit:n,reset:r,formState:{errors:a,isSubmitting:s}}=oa({resolver:ia(ua),defaultValues:{text:"",type:"answerable"}}),o=async i=>{await Se.saveQuestion({id:crypto.randomUUID(),text:i.text,type:i.type,generatedBy:"manual",createdAt:new Date,updatedAt:new Date,documentSampleId:e,status:"accepted"}),r()};return b.jsxs("form",{onSubmit:n(o),className:"flex gap-2 items-center mb-2",children:[b.jsxs("div",{className:"flex flex-col",children:[b.jsx("input",{className:"border rounded px-2 py-1 w-64",placeholder:"Add custom question...",...t("text")}),a.text&&b.jsx("span",{className:"text-xs text-red-500",children:a.text.message})]}),b.jsxs("div",{className:"flex flex-col",children:[b.jsxs("select",{className:"border rounded px-2 py-1",...t("type"),children:[b.jsx("option",{value:"answerable",children:"Answerable"}),b.jsx("option",{value:"non-answerable",children:"Non-Answerable"})]}),a.type&&b.jsx("span",{className:"text-xs text-red-500",children:a.type.message})]}),b.jsx("button",{type:"submit",className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:s,children:"Add"})]})},pa=({answerableCount:e,setAnswerableCount:t,nonAnswerableCount:n,setNonAnswerableCount:r,apiKey:a,apiKeyLoading:s,onGenerate:o,isGenerating:i})=>b.jsxs("div",{className:"flex flex-wrap gap-6 items-end mb-6",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"answerable-count",className:"block text-sm font-medium text-gray-700 mb-1",children:"Answerable"}),b.jsx("input",{id:"answerable-count",type:"number",min:0,value:e,onChange:l=>t(Number(l.target.value)),className:"border border-gray-300 rounded-md px-3 py-2 w-24 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"non-answerable-count",className:"block text-sm font-medium text-gray-700 mb-1",children:"Non-Answerable"}),b.jsx("input",{id:"non-answerable-count",type:"number",min:0,value:n,onChange:l=>r(Number(l.target.value)),className:"border border-gray-300 rounded-md px-3 py-2 w-24 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),b.jsx("div",{className:"flex-1"}),b.jsxs("div",{className:"flex items-center gap-2",children:[s?b.jsx("span",{className:"text-gray-500",children:"Loading API key..."}):a?b.jsx("span",{className:"text-green-600 text-sm font-medium",children:"API key loaded from settings"}):b.jsx("span",{className:"text-red-500 text-sm",children:"Missing OpenAI API key. Configure your API key in Settings."}),b.jsx("button",{type:"button",className:"px-5 py-2 bg-green-600 text-white rounded-md font-semibold shadow hover:bg-green-700 transition",onClick:o,disabled:!a||i,children:i?"Generating...":"Generate"})]})]});function da({question:e}){return b.jsxs("div",{className:"border border-border rounded p-4 mb-3 bg-card shadow",children:[b.jsxs("div",{className:"flex justify-between items-start mb-2",children:[b.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:e.type}),b.jsx("span",{className:"text-sm text-muted-foreground",children:e.generatedBy})]}),b.jsx("p",{className:"text-foreground mb-2",children:e.text}),b.jsx("div",{className:"flex gap-2",children:b.jsx("button",{type:"button",className:`px-3 py-1 rounded text-sm ${e.status==="accepted"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}`,children:e.status==="accepted"?"Accepted":"Pending"})})]})}function ma({sampleId:e}){const{data:t=[],isLoading:n,isError:r}=dt({queryKey:["questions",e],queryFn:async()=>(await Se.getDocumentSample(e))?.questions||[]});return n?b.jsx("div",{className:"text-center py-12 text-lg text-foreground",children:"Loading questions..."}):r?b.jsx("div",{className:"text-center py-12 text-lg text-destructive",children:"Error loading questions."}):t.length===0?b.jsx("div",{className:"text-center text-muted-foreground py-12 text-lg bg-card rounded-xl border border-dashed border-border",children:"No questions generated yet."}):b.jsx("div",{className:"space-y-4",children:t.map((a,s)=>b.jsx(da,{question:a},s))})}var Tn="vercel.ai.error",fa=Symbol.for(Tn),An,ha=class En extends Error{constructor({name:t,message:n,cause:r}){super(n),this[An]=!0,this.name=t,this.cause=r}static isInstance(t){return En.hasMarker(t,Tn)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};An=fa;var N=ha,Rn="AI_APICallError",jn=`vercel.ai.error.${Rn}`,ga=Symbol.for(jn),Nn,X=class extends N{constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:a,responseBody:s,cause:o,isRetryable:i=r!=null&&(r===408||r===409||r===429||r>=500),data:l}){super({name:Rn,message:e,cause:o}),this[Nn]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=a,this.responseBody=s,this.isRetryable=i,this.data=l}static isInstance(e){return N.hasMarker(e,jn)}};Nn=ga;var Cn="AI_EmptyResponseBodyError",Pn=`vercel.ai.error.${Cn}`,ya=Symbol.for(Pn),On,va=class extends N{constructor({message:e="Empty response body"}={}){super({name:Cn,message:e}),this[On]=!0}static isInstance(e){return N.hasMarker(e,Pn)}};On=ya;function Mn(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var $n="AI_InvalidArgumentError",Dn=`vercel.ai.error.${$n}`,ba=Symbol.for(Dn),qn,Un=class extends N{constructor({message:t,cause:n,argument:r}){super({name:$n,message:t,cause:n}),this[qn]=!0,this.argument=r}static isInstance(t){return N.hasMarker(t,Dn)}};qn=ba;var Fn="AI_InvalidPromptError",Ln=`vercel.ai.error.${Fn}`,_a=Symbol.for(Ln),Bn,de=class extends N{constructor({prompt:e,message:t,cause:n}){super({name:Fn,message:`Invalid prompt: ${t}`,cause:n}),this[Bn]=!0,this.prompt=e}static isInstance(e){return N.hasMarker(e,Ln)}};Bn=_a;var Jn="AI_InvalidResponseDataError",Zn=`vercel.ai.error.${Jn}`,wa=Symbol.for(Zn),Vn,bt=class extends N{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Jn,message:t}),this[Vn]=!0,this.data=e}static isInstance(e){return N.hasMarker(e,Zn)}};Vn=wa;var Gn="AI_JSONParseError",zn=`vercel.ai.error.${Gn}`,xa=Symbol.for(zn),Hn,qe=class extends N{constructor({text:e,cause:t}){super({name:Gn,message:`JSON parsing failed: Text: ${e}.
Error message: ${Mn(t)}`,cause:t}),this[Hn]=!0,this.text=e}static isInstance(e){return N.hasMarker(e,zn)}};Hn=xa;var Wn="AI_LoadAPIKeyError",Kn=`vercel.ai.error.${Wn}`,Sa=Symbol.for(Kn),Yn,Ye=class extends N{constructor({message:e}){super({name:Wn,message:e}),this[Yn]=!0}static isInstance(e){return N.hasMarker(e,Kn)}};Yn=Sa;var Qn="AI_TooManyEmbeddingValuesForCallError",Xn=`vercel.ai.error.${Qn}`,Ia=Symbol.for(Xn),er,ka=class extends N{constructor(e){super({name:Qn,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[er]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return N.hasMarker(e,Xn)}};er=Ia;var tr="AI_TypeValidationError",nr=`vercel.ai.error.${tr}`,Ta=Symbol.for(nr),rr,Aa=class Rt extends N{constructor({value:t,cause:n}){super({name:tr,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Mn(n)}`,cause:n}),this[rr]=!0,this.value=t}static isInstance(t){return N.hasMarker(t,nr)}static wrap({value:t,cause:n}){return Rt.isInstance(n)&&n.value===t?n:new Rt({value:t,cause:n})}};rr=Ta;var me=Aa,ar="AI_UnsupportedFunctionalityError",sr=`vercel.ai.error.${ar}`,Ea=Symbol.for(sr),or,U=class extends N{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:ar,message:t}),this[or]=!0,this.functionality=e}static isInstance(e){return N.hasMarker(e,sr)}};or=Ea;function rt(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(rt):typeof e=="object"?Object.entries(e).every(([t,n])=>typeof t=="string"&&rt(n)):!1}function rn(e){return Array.isArray(e)&&e.every(rt)}function jt(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,n])=>typeof t=="string"&&rt(n))}let Ra=(e,t=21)=>(n=t)=>{let r="",a=n|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};var _e={exports:{}},an;function ja(){if(an)return _e.exports;an=1;const e=typeof Buffer<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function r(i,l,u){u==null&&l!==null&&typeof l=="object"&&(u=l,l=void 0),e&&Buffer.isBuffer(i)&&(i=i.toString()),i&&i.charCodeAt(0)===65279&&(i=i.slice(1));const c=JSON.parse(i,l);if(c===null||typeof c!="object")return c;const p=u&&u.protoAction||"error",f=u&&u.constructorAction||"error";if(p==="ignore"&&f==="ignore")return c;if(p!=="ignore"&&f!=="ignore"){if(t.test(i)===!1&&n.test(i)===!1)return c}else if(p!=="ignore"&&f==="ignore"){if(t.test(i)===!1)return c}else if(n.test(i)===!1)return c;return a(c,{protoAction:p,constructorAction:f,safe:u&&u.safe})}function a(i,{protoAction:l="error",constructorAction:u="error",safe:c}={}){let p=[i];for(;p.length;){const f=p;p=[];for(const w of f){if(l!=="ignore"&&Object.prototype.hasOwnProperty.call(w,"__proto__")){if(c===!0)return null;if(l==="error")throw new SyntaxError("Object contains forbidden prototype property");delete w.__proto__}if(u!=="ignore"&&Object.prototype.hasOwnProperty.call(w,"constructor")&&Object.prototype.hasOwnProperty.call(w.constructor,"prototype")){if(c===!0)return null;if(u==="error")throw new SyntaxError("Object contains forbidden prototype property");delete w.constructor}for(const y in w){const v=w[y];v&&typeof v=="object"&&p.push(v)}}}return i}function s(i,l,u){const c=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(i,l,u)}finally{Error.stackTraceLimit=c}}function o(i,l){const u=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(i,l,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=u}}return _e.exports=s,_e.exports.default=s,_e.exports.parse=s,_e.exports.safeParse=o,_e.exports.scan=a,_e.exports}var Na=ja();const qt=Xr(Na);var Ca={};function ue(...e){return e.reduce((t,n)=>({...t,...n??{}}),{})}function Pa(e){return new ReadableStream({async pull(t){try{const{value:n,done:r}=await e.next();r?t.close():t.enqueue(n)}catch(n){t.error(n)}},cancel(){}})}async function Oa(e){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))}function Ma(){let e="",t,n=[],r,a;function s(l,u){if(l===""){o(u);return}if(l.startsWith(":"))return;const c=l.indexOf(":");if(c===-1){i(l,"");return}const p=l.slice(0,c),f=c+1,w=f<l.length&&l[f]===" "?l.slice(f+1):l.slice(f);i(p,w)}function o(l){n.length>0&&(l.enqueue({event:t,data:n.join(`
`),id:r,retry:a}),n=[],t=void 0,a=void 0)}function i(l,u){switch(l){case"event":t=u;break;case"data":n.push(u);break;case"id":r=u;break;case"retry":const c=parseInt(u,10);isNaN(c)||(a=c);break}}return new TransformStream({transform(l,u){const{lines:c,incompleteLine:p}=$a(e,l);e=p;for(let f=0;f<c.length;f++)s(c[f],u)},flush(l){s(e,l),o(l)}})}function $a(e,t){const n=[];let r=e;for(let a=0;a<t.length;){const s=t[a++];s===`
`?(n.push(r),r=""):s==="\r"?(n.push(r),r="",t[a]===`
`&&a++):r+=s}return{lines:n,incompleteLine:r}}function He(e){const t={};return e.headers.forEach((n,r)=>{t[r]=n}),t}var Ie=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=Ra(n,t);if(e==null)return a;if(n.includes(r))throw new Un({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return s=>`${e}${r}${a(s)}`},we=Ie();function Da(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function qa(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>n!=null))}function et(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Ua({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if(typeof e=="string")return e;if(e!=null)throw new Ye({message:`${r} API key must be a string.`});if(typeof process>"u")throw new Ye({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=Ca[t],e==null)throw new Ye({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Ye({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var at=Symbol.for("vercel.ai.validator");function Fa(e){return{[at]:!0,validate:e}}function La(e){return typeof e=="object"&&e!==null&&at in e&&e[at]===!0&&"validate"in e}function Ba(e){return La(e)?e:Ja(e)}function Ja(e){return Fa(t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Za({value:e,schema:t}){const n=ge({value:e,schema:t});if(!n.success)throw me.wrap({value:e,cause:n.error});return n.value}function ge({value:e,schema:t}){const n=Ba(t);try{if(n.validate==null)return{success:!0,value:e};const r=n.validate(e);return r.success?r:{success:!1,error:me.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:me.wrap({value:e,cause:r})}}}function Va({text:e,schema:t}){try{const n=qt.parse(e);return t==null?n:Za({value:n,schema:t})}catch(n){throw qe.isInstance(n)||me.isInstance(n)?n:new qe({text:e,cause:n})}}function Ee({text:e,schema:t}){try{const n=qt.parse(e);if(t==null)return{success:!0,value:n,rawValue:n};const r=ge({value:n,schema:t});return r.success?{...r,rawValue:n}:r}catch(n){return{success:!1,error:qe.isInstance(n)?n:new qe({text:e,cause:n})}}}function sn(e){try{return qt.parse(e),!0}catch{return!1}}function Ut({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;const r=ge({value:t[e],schema:n});if(!r.success)throw new Un({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var Ga=()=>globalThis.fetch,fe=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o})=>ir({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o}),za=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o})=>ir({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o}),ir=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:a,abortSignal:s,fetch:o=Ga()})=>{try{const i=await o(e,{method:"POST",headers:qa(t),body:n.content,signal:s}),l=He(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:n.values})}catch(c){throw et(c)||X.isInstance(c)?c:new X({message:"Failed to process error response",cause:c,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw u.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(u){throw u instanceof Error&&(et(u)||X.isInstance(u))?u:new X({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(i){if(et(i))throw i;if(i instanceof TypeError&&i.message==="fetch failed"){const l=i.cause;if(l!=null)throw new X({message:`Cannot connect to API: ${l.message}`,cause:l,url:e,requestBodyValues:n.values,isRetryable:!0})}throw i}},Ha=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:a,requestBodyValues:s})=>{const o=await r.text(),i=He(r);if(o.trim()==="")return{responseHeaders:i,value:new X({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n?.(r)})};try{const l=Va({text:o,schema:e});return{responseHeaders:i,value:new X({message:t(l),url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:i,value:new X({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n?.(r)})}}},Ft=e=>async({response:t})=>{const n=He(t);if(t.body==null)throw new va({});return{responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(Ma()).pipeThrough(new TransformStream({transform({data:r},a){r!=="[DONE]"&&a.enqueue(Ee({text:r,schema:e}))}}))}},Re=e=>async({response:t,url:n,requestBodyValues:r})=>{const a=await t.text(),s=Ee({text:a,schema:e}),o=He(t);if(!s.success)throw new X({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:o,responseBody:a,url:n,requestBodyValues:r});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}},Wa=()=>async({response:e,url:t,requestBodyValues:n})=>{const r=He(e);if(!e.body)throw new X({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{const a=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(a)}}catch(a){throw new X({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:a})}},{btoa:Ka,atob:Ya}=globalThis;function Lt(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Ya(t);return Uint8Array.from(n,r=>r.codePointAt(0))}function st(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Ka(t)}function Qa(e){return e?.replace(/\/$/,"")}function Xa({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:n="system"}){const r=[],a=[];for(const{role:s,content:o}of e)switch(s){case"system":{switch(n){case"system":{r.push({role:"system",content:o});break}case"developer":{r.push({role:"developer",content:o});break}case"remove":{a.push({type:"other",message:"system messages are removed for this model"});break}default:{const i=n;throw new Error(`Unsupported system message mode: ${i}`)}}break}case"user":{if(o.length===1&&o[0].type==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map((i,l)=>{var u,c,p,f;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(u=i.mimeType)!=null?u:"image/jpeg"};base64,${st(i.image)}`,detail:(p=(c=i.providerMetadata)==null?void 0:c.openai)==null?void 0:p.imageDetail}};case"file":{if(i.data instanceof URL)throw new U({functionality:"'File content parts with URL data' functionality not supported."});switch(i.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:i.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:i.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:(f=i.filename)!=null?f:`part-${l}.pdf`,file_data:`data:application/pdf;base64,${i.data}`}};default:throw new U({functionality:`File content part type ${i.mimeType} in user messages`})}}}})});break}case"assistant":{let i="";const l=[];for(const u of o)switch(u.type){case"text":{i+=u.text;break}case"tool-call":{l.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.args)}});break}}if(t){if(l.length>1)throw new U({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:i,function_call:l.length>0?l[0].function:void 0})}else r.push({role:"assistant",content:i,tool_calls:l.length>0?l:void 0});break}case"tool":{for(const i of o)t?r.push({role:"function",name:i.toolName,content:JSON.stringify(i.result)}):r.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result)});break}default:{const i=s;throw new Error(`Unsupported role: ${i}`)}}return{messages:r,warnings:a}}function on(e){var t,n;return(n=(t=e?.content)==null?void 0:t.map(({token:r,logprob:a,top_logprobs:s})=>({token:r,logprob:a,topLogprobs:s?s.map(({token:o,logprob:i})=>({token:o,logprob:i})):[]})))!=null?n:void 0}function ot(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Bt=m({error:m({message:d(),type:d().nullish(),param:Sn().nullish(),code:B([d(),I()]).nullish()})}),ce=Ha({errorSchema:Bt,errorToMessage:e=>e.error.message});function it({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function es({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:n}){var r;const a=(r=e.tools)!=null&&r.length?e.tools:void 0,s=[];if(a==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};const o=e.toolChoice;if(t){const u=[];for(const p of a)p.type==="provider-defined"?s.push({type:"unsupported-tool",tool:p}):u.push({name:p.name,description:p.description,parameters:p.parameters});if(o==null)return{functions:u,function_call:void 0,toolWarnings:s};switch(o.type){case"auto":case"none":case void 0:return{functions:u,function_call:void 0,toolWarnings:s};case"required":throw new U({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:u,function_call:{name:o.toolName},toolWarnings:s}}}const i=[];for(const u of a)u.type==="provider-defined"?s.push({type:"unsupported-tool",tool:u}):i.push({type:"function",function:{name:u.name,description:u.description,parameters:u.parameters,strict:n?!0:void 0}});if(o==null)return{tools:i,tool_choice:void 0,toolWarnings:s};const l=o.type;switch(l){case"auto":case"none":case"required":return{tools:i,tool_choice:l,toolWarnings:s};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:s};default:{const u=l;throw new U({functionality:`Unsupported tool choice type: ${u}`})}}}var ts=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:Nt(this.modelId)}get defaultObjectGenerationMode(){return as(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:l,responseFormat:u,seed:c,providerMetadata:p}){var f,w,y,v,g,h,_,k;const x=e.type,A=[];s!=null&&A.push({type:"unsupported-setting",setting:"topK"}),u?.type==="json"&&u.schema!=null&&!this.supportsStructuredOutputs&&A.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const C=this.settings.useLegacyFunctionCalling;if(C&&this.settings.parallelToolCalls===!0)throw new U({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(C&&this.supportsStructuredOutputs)throw new U({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:J,warnings:S}=Xa({prompt:t,useLegacyFunctionCalling:C,systemMessageMode:ss(this.modelId)});A.push(...S);const R={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:a,frequency_penalty:o,presence_penalty:i,response_format:u?.type==="json"?this.supportsStructuredOutputs&&u.schema!=null?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:(f=u.name)!=null?f:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,max_completion_tokens:(w=p?.openai)==null?void 0:w.maxCompletionTokens,store:(y=p?.openai)==null?void 0:y.store,metadata:(v=p?.openai)==null?void 0:v.metadata,prediction:(g=p?.openai)==null?void 0:g.prediction,reasoning_effort:(_=(h=p?.openai)==null?void 0:h.reasoningEffort)!=null?_:this.settings.reasoningEffort,messages:J};switch(Nt(this.modelId)?(R.temperature!=null&&(R.temperature=void 0,A.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),R.top_p!=null&&(R.top_p=void 0,A.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),R.frequency_penalty!=null&&(R.frequency_penalty=void 0,A.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),R.presence_penalty!=null&&(R.presence_penalty=void 0,A.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),R.logit_bias!=null&&(R.logit_bias=void 0,A.push({type:"other",message:"logitBias is not supported for reasoning models"})),R.logprobs!=null&&(R.logprobs=void 0,A.push({type:"other",message:"logprobs is not supported for reasoning models"})),R.top_logprobs!=null&&(R.top_logprobs=void 0,A.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),R.max_tokens!=null&&(R.max_completion_tokens==null&&(R.max_completion_tokens=R.max_tokens),R.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&R.temperature!=null&&(R.temperature=void 0,A.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),x){case"regular":{const{tools:pe,tool_choice:ye,functions:ve,function_call:re,toolWarnings:z}=es({mode:e,useLegacyFunctionCalling:C,structuredOutputs:this.supportsStructuredOutputs});return{args:{...R,tools:pe,tool_choice:ye,functions:ve,function_call:re},warnings:[...A,...z]}}case"object-json":return{args:{...R,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(k=e.name)!=null?k:"response",description:e.description}}:{type:"json_object"}},warnings:A};case"object-tool":return{args:C?{...R,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...R,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:A};default:{const pe=x;throw new Error(`Unsupported type: ${pe}`)}}}async doGenerate(e){var t,n,r,a,s,o,i,l;const{args:u,warnings:c}=this.getArgs(e),{responseHeaders:p,value:f,rawValue:w}=await fe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:u,failedResponseHandler:ce,successfulResponseHandler:Re(ns),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:y,...v}=u,g=f.choices[0],h=(t=f.usage)==null?void 0:t.completion_tokens_details,_=(n=f.usage)==null?void 0:n.prompt_tokens_details,k={openai:{}};return h?.reasoning_tokens!=null&&(k.openai.reasoningTokens=h?.reasoning_tokens),h?.accepted_prediction_tokens!=null&&(k.openai.acceptedPredictionTokens=h?.accepted_prediction_tokens),h?.rejected_prediction_tokens!=null&&(k.openai.rejectedPredictionTokens=h?.rejected_prediction_tokens),_?.cached_tokens!=null&&(k.openai.cachedPromptTokens=_?.cached_tokens),{text:(r=g.message.content)!=null?r:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&g.message.function_call?[{toolCallType:"function",toolCallId:we(),toolName:g.message.function_call.name,args:g.message.function_call.arguments}]:(a=g.message.tool_calls)==null?void 0:a.map(x=>{var A;return{toolCallType:"function",toolCallId:(A=x.id)!=null?A:we(),toolName:x.function.name,args:x.function.arguments}}),finishReason:ot(g.finish_reason),usage:{promptTokens:(o=(s=f.usage)==null?void 0:s.prompt_tokens)!=null?o:NaN,completionTokens:(l=(i=f.usage)==null?void 0:i.completion_tokens)!=null?l:NaN},rawCall:{rawPrompt:y,rawSettings:v},rawResponse:{headers:p,body:w},request:{body:JSON.stringify(u)},response:it(f),warnings:c,logprobs:on(g.logprobs),providerMetadata:k}}async doStream(e){if(this.settings.simulateStreaming){const v=await this.doGenerate(e);return{stream:new ReadableStream({start(h){if(h.enqueue({type:"response-metadata",...v.response}),v.text&&h.enqueue({type:"text-delta",textDelta:v.text}),v.toolCalls)for(const _ of v.toolCalls)h.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:_.toolCallId,toolName:_.toolName,argsTextDelta:_.args}),h.enqueue({type:"tool-call",..._});h.enqueue({type:"finish",finishReason:v.finishReason,usage:v.usage,logprobs:v.logprobs,providerMetadata:v.providerMetadata}),h.close()}}),rawCall:v.rawCall,rawResponse:v.rawResponse,warnings:v.warnings}}const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:a,value:s}=await fe({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:r,failedResponseHandler:ce,successfulResponseHandler:Ft(rs),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t,l=[];let u="unknown",c={promptTokens:void 0,completionTokens:void 0},p,f=!0;const{useLegacyFunctionCalling:w}=this.settings,y={openai:{}};return{stream:s.pipeThrough(new TransformStream({transform(v,g){var h,_,k,x,A,C,J,S,R,pe,ye,ve;if(!v.success){u="error",g.enqueue({type:"error",error:v.error});return}const re=v.value;if("error"in re){u="error",g.enqueue({type:"error",error:re.error});return}if(f&&(f=!1,g.enqueue({type:"response-metadata",...it(re)})),re.usage!=null){const{prompt_tokens:D,completion_tokens:W,prompt_tokens_details:F,completion_tokens_details:M}=re.usage;c={promptTokens:D??void 0,completionTokens:W??void 0},M?.reasoning_tokens!=null&&(y.openai.reasoningTokens=M?.reasoning_tokens),M?.accepted_prediction_tokens!=null&&(y.openai.acceptedPredictionTokens=M?.accepted_prediction_tokens),M?.rejected_prediction_tokens!=null&&(y.openai.rejectedPredictionTokens=M?.rejected_prediction_tokens),F?.cached_tokens!=null&&(y.openai.cachedPromptTokens=F?.cached_tokens)}const z=re.choices[0];if(z?.finish_reason!=null&&(u=ot(z.finish_reason)),z?.delta==null)return;const ee=z.delta;ee.content!=null&&g.enqueue({type:"text-delta",textDelta:ee.content});const te=on(z?.logprobs);te?.length&&(p===void 0&&(p=[]),p.push(...te));const ke=w&&ee.function_call!=null?[{type:"function",id:we(),function:ee.function_call,index:0}]:ee.tool_calls;if(ke!=null)for(const D of ke){const W=D.index;if(l[W]==null){if(D.type!=="function")throw new bt({data:D,message:"Expected 'function' type."});if(D.id==null)throw new bt({data:D,message:"Expected 'id' to be a string."});if(((h=D.function)==null?void 0:h.name)==null)throw new bt({data:D,message:"Expected 'function.name' to be a string."});l[W]={id:D.id,type:"function",function:{name:D.function.name,arguments:(_=D.function.arguments)!=null?_:""},hasFinished:!1};const M=l[W];((k=M.function)==null?void 0:k.name)!=null&&((x=M.function)==null?void 0:x.arguments)!=null&&(M.function.arguments.length>0&&g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:M.id,toolName:M.function.name,argsTextDelta:M.function.arguments}),sn(M.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(A=M.id)!=null?A:we(),toolName:M.function.name,args:M.function.arguments}),M.hasFinished=!0));continue}const F=l[W];F.hasFinished||(((C=D.function)==null?void 0:C.arguments)!=null&&(F.function.arguments+=(S=(J=D.function)==null?void 0:J.arguments)!=null?S:""),g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:F.id,toolName:F.function.name,argsTextDelta:(R=D.function.arguments)!=null?R:""}),((pe=F.function)==null?void 0:pe.name)!=null&&((ye=F.function)==null?void 0:ye.arguments)!=null&&sn(F.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ve=F.id)!=null?ve:we(),toolName:F.function.name,args:F.function.arguments}),F.hasFinished=!0))}},flush(v){var g,h;v.enqueue({type:"finish",finishReason:u,logprobs:p,usage:{promptTokens:(g=c.promptTokens)!=null?g:NaN,completionTokens:(h=c.completionTokens)!=null?h:NaN},...y!=null?{providerMetadata:y}:{}})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},request:{body:JSON.stringify(r)},warnings:n}}},lr=m({prompt_tokens:I().nullish(),completion_tokens:I().nullish(),prompt_tokens_details:m({cached_tokens:I().nullish()}).nullish(),completion_tokens_details:m({reasoning_tokens:I().nullish(),accepted_prediction_tokens:I().nullish(),rejected_prediction_tokens:I().nullish()}).nullish()}).nullish(),ns=m({id:d().nullish(),created:I().nullish(),model:d().nullish(),choices:j(m({message:m({role:T("assistant").nullish(),content:d().nullish(),function_call:m({arguments:d(),name:d()}).nullish(),tool_calls:j(m({id:d().nullish(),type:T("function"),function:m({name:d(),arguments:d()})})).nullish()}),index:I(),logprobs:m({content:j(m({token:d(),logprob:I(),top_logprobs:j(m({token:d(),logprob:I()}))})).nullable()}).nullish(),finish_reason:d().nullish()})),usage:lr}),rs=B([m({id:d().nullish(),created:I().nullish(),model:d().nullish(),choices:j(m({delta:m({role:mt(["assistant"]).nullish(),content:d().nullish(),function_call:m({name:d().optional(),arguments:d().optional()}).nullish(),tool_calls:j(m({index:I(),id:d().nullish(),type:T("function").nullish(),function:m({name:d().nullish(),arguments:d().nullish()})})).nullish()}).nullish(),logprobs:m({content:j(m({token:d(),logprob:I(),top_logprobs:j(m({token:d(),logprob:I()}))})).nullable()}).nullish(),finish_reason:d().nullish(),index:I()})),usage:lr}),Bt]);function Nt(e){return e.startsWith("o")}function as(e){return e.startsWith("gpt-4o-audio-preview")}function ss(e){var t,n;return Nt(e)?(n=(t=os[e])==null?void 0:t.systemMessageMode)!=null?n:"developer":"system"}var os={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function is({prompt:e,inputFormat:t,user:n="user",assistant:r="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let a="";e[0].role==="system"&&(a+=`${e[0].content}

`,e=e.slice(1));for(const{role:s,content:o}of e)switch(s){case"system":throw new de({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const i=o.map(l=>{switch(l.type){case"text":return l.text;case"image":throw new U({functionality:"images"})}}).join("");a+=`${n}:
${i}

`;break}case"assistant":{const i=o.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new U({functionality:"tool-call messages"})}}).join("");a+=`${r}:
${i}

`;break}case"tool":throw new U({functionality:"tool messages"});default:{const i=s;throw new Error(`Unsupported role: ${i}`)}}return a+=`${r}:
`,{prompt:a,stopSequences:[`
${n}:`]}}function ln(e){return e?.tokens.map((t,n)=>({token:t,logprob:e.token_logprobs[n],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[n]).map(([r,a])=>({token:r,logprob:a})):[]}))}var ls=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:n,maxTokens:r,temperature:a,topP:s,topK:o,frequencyPenalty:i,presencePenalty:l,stopSequences:u,responseFormat:c,seed:p}){var f;const w=e.type,y=[];o!=null&&y.push({type:"unsupported-setting",setting:"topK"}),c!=null&&c.type!=="text"&&y.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:v,stopSequences:g}=is({prompt:n,inputFormat:t}),h=[...g??[],...u??[]],_={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:r,temperature:a,top_p:s,frequency_penalty:i,presence_penalty:l,seed:p,prompt:v,stop:h.length>0?h:void 0};switch(w){case"regular":{if((f=e.tools)!=null&&f.length)throw new U({functionality:"tools"});if(e.toolChoice)throw new U({functionality:"toolChoice"});return{args:_,warnings:y}}case"object-json":throw new U({functionality:"object-json mode"});case"object-tool":throw new U({functionality:"object-tool mode"});default:{const k=w;throw new Error(`Unsupported type: ${k}`)}}}async doGenerate(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:a,rawValue:s}=await fe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:t,failedResponseHandler:ce,successfulResponseHandler:Re(us),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t,l=a.choices[0];return{text:l.text,usage:{promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens},finishReason:ot(l.finish_reason),logprobs:ln(l.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r,body:s},response:it(a),warnings:n,request:{body:JSON.stringify(t)}}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:a,value:s}=await fe({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:r,failedResponseHandler:ce,successfulResponseHandler:Ft(cs),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t;let l="unknown",u={promptTokens:Number.NaN,completionTokens:Number.NaN},c,p=!0;return{stream:s.pipeThrough(new TransformStream({transform(f,w){if(!f.success){l="error",w.enqueue({type:"error",error:f.error});return}const y=f.value;if("error"in y){l="error",w.enqueue({type:"error",error:y.error});return}p&&(p=!1,w.enqueue({type:"response-metadata",...it(y)})),y.usage!=null&&(u={promptTokens:y.usage.prompt_tokens,completionTokens:y.usage.completion_tokens});const v=y.choices[0];v?.finish_reason!=null&&(l=ot(v.finish_reason)),v?.text!=null&&w.enqueue({type:"text-delta",textDelta:v.text});const g=ln(v?.logprobs);g?.length&&(c===void 0&&(c=[]),c.push(...g))},flush(f){f.enqueue({type:"finish",finishReason:l,logprobs:c,usage:u})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},warnings:n,request:{body:JSON.stringify(r)}}}},us=m({id:d().nullish(),created:I().nullish(),model:d().nullish(),choices:j(m({text:d(),finish_reason:d(),logprobs:m({tokens:j(d()),token_logprobs:j(I()),top_logprobs:j(De(d(),I())).nullable()}).nullish()})),usage:m({prompt_tokens:I(),completion_tokens:I()})}),cs=B([m({id:d().nullish(),created:I().nullish(),model:d().nullish(),choices:j(m({text:d(),finish_reason:d().nullish(),index:I(),logprobs:m({tokens:j(d()),token_logprobs:j(I()),top_logprobs:j(De(d(),I())).nullable()}).nullish()})),usage:m({prompt_tokens:I(),completion_tokens:I()}).nullish()}),Bt]),ps=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:n}){if(e.length>this.maxEmbeddingsPerCall)throw new ka({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:r,value:a}=await fe({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:ue(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:ce,successfulResponseHandler:Re(ds),abortSignal:n,fetch:this.config.fetch});return{embeddings:a.data.map(s=>s.embedding),usage:a.usage?{tokens:a.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},ds=m({data:j(m({embedding:j(I())})),usage:m({prompt_tokens:I()}).nullish()}),ms={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},fs=new Set(["gpt-image-1"]),hs=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return(t=(e=this.settings.maxImagesPerCall)!=null?e:ms[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:a,providerOptions:s,headers:o,abortSignal:i}){var l,u,c,p;const f=[];r!=null&&f.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),a!=null&&f.push({type:"unsupported-setting",setting:"seed"});const w=(c=(u=(l=this.config._internal)==null?void 0:l.currentDate)==null?void 0:u.call(l))!=null?c:new Date,{value:y,responseHeaders:v}=await fe({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:ue(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(p=s.openai)!=null?p:{},...fs.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:ce,successfulResponseHandler:Re(gs),abortSignal:i,fetch:this.config.fetch});return{images:y.data.map(g=>g.b64_json),warnings:f,response:{timestamp:w,modelId:this.modelId,headers:v}}}},gs=m({data:j(m({b64_json:d()}))}),ys=m({include:j(d()).nullish(),language:d().nullish(),prompt:d().nullish(),temperature:I().min(0).max(1).nullish().default(0),timestampGranularities:j(mt(["word","segment"])).nullish().default(["segment"])}),un={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},vs=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:n}){var r,a,s,o,i;const l=[],u=Ut({provider:"openai",providerOptions:n,schema:ys}),c=new FormData,p=e instanceof Uint8Array?new Blob([e]):new Blob([Lt(e)]);if(c.append("model",this.modelId),c.append("file",new File([p],"audio",{type:t})),u){const f={include:(r=u.include)!=null?r:void 0,language:(a=u.language)!=null?a:void 0,prompt:(s=u.prompt)!=null?s:void 0,temperature:(o=u.temperature)!=null?o:void 0,timestamp_granularities:(i=u.timestampGranularities)!=null?i:void 0};for(const w in f){const y=f[w];y!==void 0&&c.append(w,String(y))}}return{formData:c,warnings:l}}async doGenerate(e){var t,n,r,a,s,o;const i=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{formData:l,warnings:u}=this.getArgs(e),{value:c,responseHeaders:p,rawValue:f}=await za({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),formData:l,failedResponseHandler:ce,successfulResponseHandler:Re(bs),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=c.language!=null&&c.language in un?un[c.language]:void 0;return{text:c.text,segments:(s=(a=c.words)==null?void 0:a.map(y=>({text:y.word,startSecond:y.start,endSecond:y.end})))!=null?s:[],language:w,durationInSeconds:(o=c.duration)!=null?o:void 0,warnings:u,response:{timestamp:i,modelId:this.modelId,headers:p,body:f}}}},bs=m({text:d(),language:d().nullish(),duration:I().nullish(),words:j(m({word:d(),start:I(),end:I()})).nullish()});function _s({prompt:e,systemMessageMode:t}){const n=[],r=[];for(const{role:a,content:s}of e)switch(a){case"system":{switch(t){case"system":{n.push({role:"system",content:s});break}case"developer":{n.push({role:"developer",content:s});break}case"remove":{r.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=t;throw new Error(`Unsupported system message mode: ${o}`)}}break}case"user":{n.push({role:"user",content:s.map((o,i)=>{var l,u,c,p;switch(o.type){case"text":return{type:"input_text",text:o.text};case"image":return{type:"input_image",image_url:o.image instanceof URL?o.image.toString():`data:${(l=o.mimeType)!=null?l:"image/jpeg"};base64,${st(o.image)}`,detail:(c=(u=o.providerMetadata)==null?void 0:u.openai)==null?void 0:c.imageDetail};case"file":{if(o.data instanceof URL)throw new U({functionality:"File URLs in user messages"});switch(o.mimeType){case"application/pdf":return{type:"input_file",filename:(p=o.filename)!=null?p:`part-${i}.pdf`,file_data:`data:application/pdf;base64,${o.data}`};default:throw new U({functionality:"Only PDF files are supported in user messages"})}}}})});break}case"assistant":{for(const o of s)switch(o.type){case"text":{n.push({role:"assistant",content:[{type:"output_text",text:o.text}]});break}case"tool-call":{n.push({type:"function_call",call_id:o.toolCallId,name:o.toolName,arguments:JSON.stringify(o.args)});break}}break}case"tool":{for(const o of s)n.push({type:"function_call_output",call_id:o.toolCallId,output:JSON.stringify(o.result)});break}default:{const o=a;throw new Error(`Unsupported role: ${o}`)}}return{messages:n,warnings:r}}function cn({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}function ws({mode:e,strict:t}){var n;const r=(n=e.tools)!=null&&n.length?e.tools:void 0,a=[];if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:a};const s=e.toolChoice,o=[];for(const l of r)switch(l.type){case"function":o.push({type:"function",name:l.name,description:l.description,parameters:l.parameters,strict:t?!0:void 0});break;case"provider-defined":switch(l.id){case"openai.web_search_preview":o.push({type:"web_search_preview",search_context_size:l.args.searchContextSize,user_location:l.args.userLocation});break;default:a.push({type:"unsupported-tool",tool:l});break}break;default:a.push({type:"unsupported-tool",tool:l});break}if(s==null)return{tools:o,tool_choice:void 0,toolWarnings:a};const i=s.type;switch(i){case"auto":case"none":case"required":return{tools:o,tool_choice:i,toolWarnings:a};case"tool":return s.toolName==="web_search_preview"?{tools:o,tool_choice:{type:"web_search_preview"},toolWarnings:a}:{tools:o,tool_choice:{type:"function",name:s.toolName},toolWarnings:a};default:{const l=i;throw new U({functionality:`Unsupported tool choice type: ${l}`})}}}var xs=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:n,stopSequences:r,topP:a,topK:s,presencePenalty:o,frequencyPenalty:i,seed:l,prompt:u,providerMetadata:c,responseFormat:p}){var f,w,y;const v=[],g=Bs(this.modelId),h=e.type;s!=null&&v.push({type:"unsupported-setting",setting:"topK"}),l!=null&&v.push({type:"unsupported-setting",setting:"seed"}),o!=null&&v.push({type:"unsupported-setting",setting:"presencePenalty"}),i!=null&&v.push({type:"unsupported-setting",setting:"frequencyPenalty"}),r!=null&&v.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:_,warnings:k}=_s({prompt:u,systemMessageMode:g.systemMessageMode});v.push(...k);const x=Ut({provider:"openai",providerOptions:c,schema:Js}),A=(f=x?.strictSchemas)!=null?f:!0,C={model:this.modelId,input:_,temperature:n,top_p:a,max_output_tokens:t,...p?.type==="json"&&{text:{format:p.schema!=null?{type:"json_schema",strict:A,name:(w=p.name)!=null?w:"response",description:p.description,schema:p.schema}:{type:"json_object"}}},metadata:x?.metadata,parallel_tool_calls:x?.parallelToolCalls,previous_response_id:x?.previousResponseId,store:x?.store,user:x?.user,instructions:x?.instructions,...g.isReasoningModel&&(x?.reasoningEffort!=null||x?.reasoningSummary!=null)&&{reasoning:{...x?.reasoningEffort!=null&&{effort:x.reasoningEffort},...x?.reasoningSummary!=null&&{summary:x.reasoningSummary}}},...g.requiredAutoTruncation&&{truncation:"auto"}};switch(g.isReasoningModel&&(C.temperature!=null&&(C.temperature=void 0,v.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),C.top_p!=null&&(C.top_p=void 0,v.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),h){case"regular":{const{tools:J,tool_choice:S,toolWarnings:R}=ws({mode:e,strict:A});return{args:{...C,tools:J,tool_choice:S},warnings:[...v,...R]}}case"object-json":return{args:{...C,text:{format:e.schema!=null?{type:"json_schema",strict:A,name:(y=e.name)!=null?y:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:v};case"object-tool":return{args:{...C,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:A}]},warnings:v};default:{const J=h;throw new Error(`Unsupported type: ${J}`)}}}async doGenerate(e){var t,n,r,a,s,o,i;const{args:l,warnings:u}=this.getArgs(e),c=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:p,value:f,rawValue:w}=await fe({url:c,headers:ue(this.config.headers(),e.headers),body:l,failedResponseHandler:ce,successfulResponseHandler:Re(m({id:d(),created_at:I(),error:m({message:d(),code:d()}).nullish(),model:d(),output:j(Dt("type",[m({type:T("message"),role:T("assistant"),content:j(m({type:T("output_text"),text:d(),annotations:j(m({type:T("url_citation"),start_index:I(),end_index:I(),url:d(),title:d()}))}))}),m({type:T("function_call"),call_id:d(),name:d(),arguments:d()}),m({type:T("web_search_call")}),m({type:T("computer_call")}),m({type:T("reasoning"),summary:j(m({type:T("summary_text"),text:d()}))})])),incomplete_details:m({reason:d()}).nullable(),usage:ur})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(f.error)throw new X({message:f.error.message,url:c,requestBodyValues:l,statusCode:400,responseHeaders:p,responseBody:w,isRetryable:!1});const y=f.output.filter(h=>h.type==="message").flatMap(h=>h.content).filter(h=>h.type==="output_text"),v=f.output.filter(h=>h.type==="function_call").map(h=>({toolCallType:"function",toolCallId:h.call_id,toolName:h.name,args:h.arguments})),g=(n=(t=f.output.find(h=>h.type==="reasoning"))==null?void 0:t.summary)!=null?n:null;return{text:y.map(h=>h.text).join(`
`),sources:y.flatMap(h=>h.annotations.map(_=>{var k,x,A;return{sourceType:"url",id:(A=(x=(k=this.config).generateId)==null?void 0:x.call(k))!=null?A:we(),url:_.url,title:_.title}})),finishReason:cn({finishReason:(r=f.incomplete_details)==null?void 0:r.reason,hasToolCalls:v.length>0}),toolCalls:v.length>0?v:void 0,reasoning:g?g.map(h=>({type:"text",text:h.text})):void 0,usage:{promptTokens:f.usage.input_tokens,completionTokens:f.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:p,body:w},request:{body:JSON.stringify(l)},response:{id:f.id,timestamp:new Date(f.created_at*1e3),modelId:f.model},providerMetadata:{openai:{responseId:f.id,cachedPromptTokens:(s=(a=f.usage.input_tokens_details)==null?void 0:a.cached_tokens)!=null?s:null,reasoningTokens:(i=(o=f.usage.output_tokens_details)==null?void 0:o.reasoning_tokens)!=null?i:null}},warnings:u}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:a}=await fe({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:ce,successfulResponseHandler:Ft(Cs),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=this;let o="unknown",i=NaN,l=NaN,u=null,c=null,p=null;const f={};let w=!1;return{stream:a.pipeThrough(new TransformStream({transform(y,v){var g,h,_,k,x,A,C,J;if(!y.success){o="error",v.enqueue({type:"error",error:y.error});return}const S=y.value;if(qs(S))S.item.type==="function_call"&&(f[S.output_index]={toolName:S.item.name,toolCallId:S.item.call_id},v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:S.item.call_id,toolName:S.item.name,argsTextDelta:S.item.arguments}));else if(Ds(S)){const R=f[S.output_index];R!=null&&v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:R.toolCallId,toolName:R.toolName,argsTextDelta:S.delta})}else $s(S)?(p=S.response.id,v.enqueue({type:"response-metadata",id:S.response.id,timestamp:new Date(S.response.created_at*1e3),modelId:S.response.model})):Ps(S)?v.enqueue({type:"text-delta",textDelta:S.delta}):Fs(S)?v.enqueue({type:"reasoning",textDelta:S.delta}):Os(S)&&S.item.type==="function_call"?(f[S.output_index]=void 0,w=!0,v.enqueue({type:"tool-call",toolCallType:"function",toolCallId:S.item.call_id,toolName:S.item.name,args:S.item.arguments})):Ms(S)?(o=cn({finishReason:(g=S.response.incomplete_details)==null?void 0:g.reason,hasToolCalls:w}),i=S.response.usage.input_tokens,l=S.response.usage.output_tokens,u=(_=(h=S.response.usage.input_tokens_details)==null?void 0:h.cached_tokens)!=null?_:u,c=(x=(k=S.response.usage.output_tokens_details)==null?void 0:k.reasoning_tokens)!=null?x:c):Us(S)?v.enqueue({type:"source",source:{sourceType:"url",id:(J=(C=(A=s.config).generateId)==null?void 0:C.call(A))!=null?J:we(),url:S.annotation.url,title:S.annotation.title}}):Ls(S)&&v.enqueue({type:"error",error:S})},flush(y){y.enqueue({type:"finish",finishReason:o,usage:{promptTokens:i,completionTokens:l},...(u!=null||c!=null)&&{providerMetadata:{openai:{responseId:p,cachedPromptTokens:u,reasoningTokens:c}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:r},request:{body:JSON.stringify(t)},warnings:n}}},ur=m({input_tokens:I(),input_tokens_details:m({cached_tokens:I().nullish()}).nullish(),output_tokens:I(),output_tokens_details:m({reasoning_tokens:I().nullish()}).nullish()}),Ss=m({type:T("response.output_text.delta"),delta:d()}),Is=m({type:mt(["response.completed","response.incomplete"]),response:m({incomplete_details:m({reason:d()}).nullish(),usage:ur})}),ks=m({type:T("response.created"),response:m({id:d(),created_at:I(),model:d()})}),Ts=m({type:T("response.output_item.done"),output_index:I(),item:Dt("type",[m({type:T("message")}),m({type:T("function_call"),id:d(),call_id:d(),name:d(),arguments:d(),status:T("completed")})])}),As=m({type:T("response.function_call_arguments.delta"),item_id:d(),output_index:I(),delta:d()}),Es=m({type:T("response.output_item.added"),output_index:I(),item:Dt("type",[m({type:T("message")}),m({type:T("function_call"),id:d(),call_id:d(),name:d(),arguments:d()})])}),Rs=m({type:T("response.output_text.annotation.added"),annotation:m({type:T("url_citation"),url:d(),title:d()})}),js=m({type:T("response.reasoning_summary_text.delta"),item_id:d(),output_index:I(),summary_index:I(),delta:d()}),Ns=m({type:T("error"),code:d(),message:d(),param:d().nullish(),sequence_number:I()}),Cs=B([Ss,Is,ks,Ts,As,Es,Rs,js,Ns,m({type:d()}).passthrough()]);function Ps(e){return e.type==="response.output_text.delta"}function Os(e){return e.type==="response.output_item.done"}function Ms(e){return e.type==="response.completed"||e.type==="response.incomplete"}function $s(e){return e.type==="response.created"}function Ds(e){return e.type==="response.function_call_arguments.delta"}function qs(e){return e.type==="response.output_item.added"}function Us(e){return e.type==="response.output_text.annotation.added"}function Fs(e){return e.type==="response.reasoning_summary_text.delta"}function Ls(e){return e.type==="error"}function Bs(e){return e.startsWith("o")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}var Js=m({metadata:Sn().nullish(),parallelToolCalls:le().nullish(),previousResponseId:d().nullish(),store:le().nullish(),user:d().nullish(),reasoningEffort:d().nullish(),strictSchemas:le().nullish(),instructions:d().nullish(),reasoningSummary:d().nullish()}),Zs=m({});function Vs({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:Zs}}var Gs={webSearchPreview:Vs},zs=m({instructions:d().nullish(),speed:I().min(.25).max(4).default(1).nullish()}),Hs=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:r,instructions:a,providerOptions:s}){const o=[],i=Ut({provider:"openai",providerOptions:s,schema:zs}),l={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:r,instructions:a};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?l.response_format=n:o.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),i){const u={};for(const c in u){const p=u[c];p!==void 0&&(l[c]=p)}}return{requestBody:l,warnings:o}}async doGenerate(e){var t,n,r;const a=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{requestBody:s,warnings:o}=this.getArgs(e),{value:i,responseHeaders:l,rawValue:u}=await fe({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:ue(this.config.headers(),e.headers),body:s,failedResponseHandler:ce,successfulResponseHandler:Wa(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:i,warnings:o,request:{body:JSON.stringify(s)},response:{timestamp:a,modelId:this.modelId,headers:l,body:u}}}};function cr(e={}){var t,n,r;const a=(t=Qa(e.baseURL))!=null?t:"https://api.openai.com/v1",s=(n=e.compatibility)!=null?n:"compatible",o=(r=e.name)!=null?r:"openai",i=()=>({Authorization:`Bearer ${Ua({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),l=(h,_={})=>new ts(h,_,{provider:`${o}.chat`,url:({path:k})=>`${a}${k}`,headers:i,compatibility:s,fetch:e.fetch}),u=(h,_={})=>new ls(h,_,{provider:`${o}.completion`,url:({path:k})=>`${a}${k}`,headers:i,compatibility:s,fetch:e.fetch}),c=(h,_={})=>new ps(h,_,{provider:`${o}.embedding`,url:({path:k})=>`${a}${k}`,headers:i,fetch:e.fetch}),p=(h,_={})=>new hs(h,_,{provider:`${o}.image`,url:({path:k})=>`${a}${k}`,headers:i,fetch:e.fetch}),f=h=>new vs(h,{provider:`${o}.transcription`,url:({path:_})=>`${a}${_}`,headers:i,fetch:e.fetch}),w=h=>new Hs(h,{provider:`${o}.speech`,url:({path:_})=>`${a}${_}`,headers:i,fetch:e.fetch}),y=(h,_)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return h==="gpt-3.5-turbo-instruct"?u(h,_):l(h,_)},v=h=>new xs(h,{provider:`${o}.responses`,url:({path:_})=>`${a}${_}`,headers:i,fetch:e.fetch}),g=function(h,_){return y(h,_)};return g.languageModel=y,g.chat=l,g.completion=u,g.responses=v,g.embedding=c,g.textEmbedding=c,g.textEmbeddingModel=c,g.image=p,g.imageModel=p,g.transcription=f,g.transcriptionModel=f,g.speech=w,g.speechModel=w,g.tools=Gs,g}cr({compatibility:"strict"});const Ws=Symbol("Let zodToJsonSchema decide on which parser to use"),pn={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Ks=e=>typeof e=="string"?{...pn,name:e}:{...pn,...e},Ys=e=>{const t=Ks(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function pr(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function O(e,t,n,r,a){e[t]=n,pr(e,t,r,a)}const dr=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function Y(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?dr(t,e.currentPath):t.join("/")}}function Qs(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==E.ZodAny&&(n.items=P(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&O(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&O(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(O(n,"minItems",e.exactLength.value,e.exactLength.message,t),O(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function Xs(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?O(n,"minimum",r.value,r.message,t):O(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),O(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?O(n,"maximum",r.value,r.message,t):O(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),O(n,"maximum",r.value,r.message,t));break;case"multipleOf":O(n,"multipleOf",r.value,r.message,t);break}return n}function eo(){return{type:"boolean"}}function mr(e,t){return P(e.type._def,t)}const to=(e,t)=>P(e.innerType._def,t);function fr(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,s)=>fr(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return no(e,t)}}const no=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":O(n,"minimum",r.value,r.message,t);break;case"max":O(n,"maximum",r.value,r.message,t);break}return n};function ro(e,t){return{...P(e.innerType._def,t),default:e.defaultValue()}}function ao(e,t){return t.effectStrategy==="input"?P(e.schema._def,t):Y(t)}function so(e){return{type:"string",enum:Array.from(e.values)}}const oo=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function io(e,t){const n=[P(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),P(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(s=>{if(oo(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:i,...l}=s;o=l}else r=void 0;a.push(o)}}),a.length?{allOf:a,...r}:void 0}function lo(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let _t;const se={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(_t===void 0&&(_t=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),_t),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function hr(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":O(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":O(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":oe(n,"email",r.message,t);break;case"format:idn-email":oe(n,"idn-email",r.message,t);break;case"pattern:zod":H(n,se.email,r.message,t);break}break;case"url":oe(n,"uri",r.message,t);break;case"uuid":oe(n,"uuid",r.message,t);break;case"regex":H(n,r.regex,r.message,t);break;case"cuid":H(n,se.cuid,r.message,t);break;case"cuid2":H(n,se.cuid2,r.message,t);break;case"startsWith":H(n,RegExp(`^${wt(r.value,t)}`),r.message,t);break;case"endsWith":H(n,RegExp(`${wt(r.value,t)}$`),r.message,t);break;case"datetime":oe(n,"date-time",r.message,t);break;case"date":oe(n,"date",r.message,t);break;case"time":oe(n,"time",r.message,t);break;case"duration":oe(n,"duration",r.message,t);break;case"length":O(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),O(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{H(n,RegExp(wt(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&oe(n,"ipv4",r.message,t),r.version!=="v4"&&oe(n,"ipv6",r.message,t);break}case"base64url":H(n,se.base64url,r.message,t);break;case"jwt":H(n,se.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&H(n,se.ipv4Cidr,r.message,t),r.version!=="v4"&&H(n,se.ipv6Cidr,r.message,t);break}case"emoji":H(n,se.emoji(),r.message,t);break;case"ulid":{H(n,se.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{oe(n,"binary",r.message,t);break}case"contentEncoding:base64":{O(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{H(n,se.base64,r.message,t);break}}break}case"nanoid":H(n,se.nanoid,r.message,t)}return n}function wt(e,t){return t.patternStrategy==="escape"?co(e):e}const uo=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function co(e){let t="";for(let n=0;n<e.length;n++)uo.has(e[n])||(t+="\\"),t+=e[n];return t}function oe(e,t,n,r){e.format||e.anyOf?.some(a=>a.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):O(e,"format",t,n,r)}function H(e,t,n,r){e.pattern||e.allOf?.some(a=>a.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:dn(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):O(e,"pattern",dn(t,r),n,r)}function dn(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",s=!1,o=!1,i=!1;for(let l=0;l<r.length;l++){if(s){a+=r[l],s=!1;continue}if(n.i){if(o){if(r[l].match(/[a-z]/)){i?(a+=r[l],a+=`${r[l-2]}-${r[l]}`.toUpperCase(),i=!1):r[l+1]==="-"&&r[l+2]?.match(/[a-z]/)?(a+=r[l],i=!0):a+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){a+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){a+=o?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}a+=r[l],r[l]==="\\"?s=!0:o&&r[l]==="]"?o=!1:!o&&r[l]==="["&&(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function gr(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===E.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:P(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??Y(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:P(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(e.keyType?._def.typeName===E.ZodString&&e.keyType._def.checks?.length){const{type:r,...a}=hr(e.keyType._def,t);return{...n,propertyNames:a}}else{if(e.keyType?._def.typeName===E.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===E.ZodBranded&&e.keyType._def.type._def.typeName===E.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...a}=mr(e.keyType._def,t);return{...n,propertyNames:a}}}return n}function po(e,t){if(t.mapStrategy==="record")return gr(e,t);const n=P(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Y(t),r=P(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Y(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function mo(e){const t=e.values,r=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),a=Array.from(new Set(r.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function fo(e){return e.target==="openAi"?void 0:{not:Y({...e,currentPath:[...e.currentPath,"not"]})}}function ho(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const lt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function go(e,t){if(t.target==="openApi3")return mn(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in lt&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,s)=>{const o=lt[s._def.typeName];return o&&!a.includes(o)?[...a,o]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...a,o];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((s,o,i)=>i.indexOf(s)===o);return{type:a.length>1?a:a[0],enum:n.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(s=>!r.includes(s))],[])};return mn(e,t)}const mn=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>P(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function yo(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:lt[e.innerType._def.typeName],nullable:!0}:{type:[lt[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=P(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=P(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function vo(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",pr(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?O(n,"minimum",r.value,r.message,t):O(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),O(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?O(n,"maximum",r.value,r.message,t):O(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),O(n,"maximum",r.value,r.message,t));break;case"multipleOf":O(n,"multipleOf",r.value,r.message,t);break}return n}function bo(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},a=[],s=e.shape();for(const i in s){let l=s[i];if(l===void 0||l._def===void 0)continue;let u=wo(l);u&&n&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=P(l._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});c!==void 0&&(r.properties[i]=c,u||a.push(i))}a.length&&(r.required=a);const o=_o(e,t);return o!==void 0&&(r.additionalProperties=o),r}function _o(e,t){if(e.catchall._def.typeName!=="ZodNever")return P(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function wo(e){try{return e.isOptional()}catch{return!0}}const xo=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return P(e.innerType._def,t);const n=P(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Y(t)},n]}:Y(t)},So=(e,t)=>{if(t.pipeStrategy==="input")return P(e.in._def,t);if(t.pipeStrategy==="output")return P(e.out._def,t);const n=P(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=P(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function Io(e,t){return P(e.type._def,t)}function ko(e,t){const r={type:"array",uniqueItems:!0,items:P(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&O(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&O(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function To(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>P(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:P(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>P(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function Ao(e){return{not:Y(e)}}function Eo(e){return Y(e)}const Ro=(e,t)=>P(e.innerType._def,t),jo=(e,t,n)=>{switch(t){case E.ZodString:return hr(e,n);case E.ZodNumber:return vo(e,n);case E.ZodObject:return bo(e,n);case E.ZodBigInt:return Xs(e,n);case E.ZodBoolean:return eo();case E.ZodDate:return fr(e,n);case E.ZodUndefined:return Ao(n);case E.ZodNull:return ho(n);case E.ZodArray:return Qs(e,n);case E.ZodUnion:case E.ZodDiscriminatedUnion:return go(e,n);case E.ZodIntersection:return io(e,n);case E.ZodTuple:return To(e,n);case E.ZodRecord:return gr(e,n);case E.ZodLiteral:return lo(e,n);case E.ZodEnum:return so(e);case E.ZodNativeEnum:return mo(e);case E.ZodNullable:return yo(e,n);case E.ZodOptional:return xo(e,n);case E.ZodMap:return po(e,n);case E.ZodSet:return ko(e,n);case E.ZodLazy:return()=>e.getter()._def;case E.ZodPromise:return Io(e,n);case E.ZodNaN:case E.ZodNever:return fo(n);case E.ZodEffects:return ao(e,n);case E.ZodAny:return Y(n);case E.ZodUnknown:return Eo(n);case E.ZodDefault:return ro(e,n);case E.ZodBranded:return mr(e,n);case E.ZodReadonly:return Ro(e,n);case E.ZodCatch:return to(e,n);case E.ZodPipeline:return So(e,n);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return(r=>{})()}};function P(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==Ws)return i}if(r&&!n){const i=No(r,t);if(i!==void 0)return i}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=jo(e,e.typeName,t),o=typeof s=="function"?P(s(),t):s;if(o&&Co(e,t,o),t.postProcess){const i=t.postProcess(o,e,t);return a.jsonSchema=o,i}return a.jsonSchema=o,o}const No=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:dr(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Y(t)):t.$refStrategy==="seen"?Y(t):void 0}},Co=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Po=(e,t)=>{const n=Ys(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((l,[u,c])=>({...l,[u]:P(c._def,{...n,currentPath:[...n.basePath,n.definitionPath,u]},!0)??Y(n)}),{}):void 0;const a=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=P(e._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??Y(n),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(s.title=o),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=a===void 0?r?{...s,[n.definitionPath]:r}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:s}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var Ue={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Fe={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Le={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Be={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Je={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},Oo=[Ue,Fe,Le,Be,Je];Ue.code+"",Fe.code+"",Le.code+"",Be.code+"",Je.code+"";Ue.name+"",Ue.code,Fe.name+"",Fe.code,Le.name+"",Le.code,Be.name+"",Be.code,Je.name+"",Je.code;Oo.map(e=>e.code);function Mo(e){const t=["ROOT"];let n=-1,r=null;function a(l,u,c){switch(l){case'"':{n=u,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=u,r=u,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{n=u,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{n=u,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function s(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=u,t.pop();break}}}function o(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,t.pop();break}}}for(let l=0;l<e.length;l++){const u=e[l];switch(t[t.length-1]){case"ROOT":a(u,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=l,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(u){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(u,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(u,l);break}case"INSIDE_STRING":{switch(u){case'"':{t.pop(),n=l;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=l}break}case"INSIDE_ARRAY_START":{switch(u){case"]":{n=l,t.pop();break}default:{n=l,a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,t.pop();break}default:{n=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=l;break}case"INSIDE_NUMBER":{switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(u,l),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(u,l);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(u,l);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(u,l);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const p=e.substring(r,l+1);!"false".startsWith(p)&&!"true".startsWith(p)&&!"null".startsWith(p)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(u,l):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(u,l)):n=l;break}}}let i=e.slice(0,n+1);for(let l=t.length-1;l>=0;l--)switch(t[l]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(r,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}function $o(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=Ee({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=Ee({text:Mo(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Do={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},qo={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Uo={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Fo={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Lo={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Bo={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Jo={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Zo={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Vo={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},Go={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},zo={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},Ho={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},Wo={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},Ko={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},Yo={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Qo={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},ht=[Do,qo,Uo,Fo,Lo,Bo,Jo,Zo,Vo,Go,zo,Ho,Wo,Ko,Yo,Qo];Object.fromEntries(ht.map(e=>[e.code,e]));Object.fromEntries(ht.map(e=>[e.name,e.code]));ht.map(e=>e.code);function yr(e,t){const n=ht.find(r=>r.name===e);if(!n)throw new Error(`Invalid stream part type: ${e}`);return`${n.code}:${JSON.stringify(t)}
`}function Xo(e,t){var n;const r=(n=void 0)!=null?n:!1;return ei(Po(e,{$refStrategy:r?"root":"none",target:"jsonSchema7"}),{validate:a=>{const s=e.safeParse(a);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}var Ct=Symbol.for("vercel.ai.schema");function ei(e,{validate:t}={}){return{[Ct]:!0,_type:void 0,[at]:!0,jsonSchema:e,validate:t}}function ti(e){return typeof e=="object"&&e!==null&&Ct in e&&e[Ct]===!0&&"jsonSchema"in e&&"validate"in e}function Pt(e){return ti(e)?e:Xo(e)}var ni=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},xe="1.9.0",fn=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function ri(e){var t=new Set([e]),n=new Set,r=e.match(fn);if(!r)return function(){return!1};var a={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(a.prerelease!=null)return function(l){return l===e};function s(i){return n.add(i),!1}function o(i){return t.add(i),!0}return function(l){if(t.has(l))return!0;if(n.has(l))return!1;var u=l.match(fn);if(!u)return s(l);var c={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return c.prerelease!=null||a.major!==c.major?s(l):a.major===0?a.minor===c.minor&&a.patch<=c.patch?o(l):s(l):a.minor<=c.minor?o(l):s(l)}}var ai=ri(xe),si=xe.split(".")[0],Ze=Symbol.for("opentelemetry.js.api."+si),Ve=ni;function Jt(e,t,n,r){var a;r===void 0&&(r=!1);var s=Ve[Ze]=(a=Ve[Ze])!==null&&a!==void 0?a:{version:xe};if(!r&&s[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(o.stack||o.message),!1}if(s.version!==xe){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+xe);return n.error(o.stack||o.message),!1}return s[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+xe+"."),!0}function Ge(e){var t,n,r=(t=Ve[Ze])===null||t===void 0?void 0:t.version;if(!(!r||!ai(r)))return(n=Ve[Ze])===null||n===void 0?void 0:n[e]}function Zt(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+xe+".");var n=Ve[Ze];n&&delete n[e]}var oi=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},ii=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},li=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Me("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Me("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Me("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Me("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Me("verbose",this._namespace,t)},e}();function Me(e,t,n){var r=Ge("diag");if(r)return n.unshift(t),r[e].apply(r,ii([],oi(n),!1))}var Q;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Q||(Q={}));function ui(e,t){e<Q.NONE?e=Q.NONE:e>Q.ALL&&(e=Q.ALL),t=t||{};function n(r,a){var s=t[r];return typeof s=="function"&&e>=a?s.bind(t):function(){}}return{error:n("error",Q.ERROR),warn:n("warn",Q.WARN),info:n("info",Q.INFO),debug:n("debug",Q.DEBUG),verbose:n("verbose",Q.VERBOSE)}}var ci=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},pi=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},di="diag",ut=function(){function e(){function t(a){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var i=Ge("diag");if(i)return i[a].apply(i,pi([],ci(s),!1))}}var n=this,r=function(a,s){var o,i,l;if(s===void 0&&(s={logLevel:Q.INFO}),a===n){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=u.stack)!==null&&o!==void 0?o:u.message),!1}typeof s=="number"&&(s={logLevel:s});var c=Ge("diag"),p=ui((i=s.logLevel)!==null&&i!==void 0?i:Q.INFO,a);if(c&&!s.suppressOverrideMessage){var f=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+f),p.warn("Current logger will overwrite one already registered from "+f)}return Jt("diag",p,n,!0)};n.setLogger=r,n.disable=function(){Zt(di,n)},n.createComponentLogger=function(a){return new li(a)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function mi(e){return Symbol.for(e)}var fi=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,a){var s=new e(n._currentContext);return s._currentContext.set(r,a),s},n.deleteValue=function(r){var a=new e(n._currentContext);return a._currentContext.delete(r),a}}return e}(),hi=new fi,gi=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},yi=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},vi=function(){function e(){}return e.prototype.active=function(){return hi},e.prototype.with=function(t,n,r){for(var a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return n.call.apply(n,yi([r],gi(a),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),bi=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},_i=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},xt="context",wi=new vi,vr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Jt(xt,t,ut.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var a,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(a=this._getContextManager()).with.apply(a,_i([t,n,r],bi(s),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return Ge(xt)||wi},e.prototype.disable=function(){this._getContextManager().disable(),Zt(xt,ut.instance())},e}(),Ot;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Ot||(Ot={}));var br="0000000000000000",_r="00000000000000000000000000000000",xi={traceId:_r,spanId:br,traceFlags:Ot.NONE},$e=function(){function e(t){t===void 0&&(t=xi),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),Vt=mi("OpenTelemetry Context Key SPAN");function Gt(e){return e.getValue(Vt)||void 0}function Si(){return Gt(vr.getInstance().active())}function zt(e,t){return e.setValue(Vt,t)}function Ii(e){return e.deleteValue(Vt)}function ki(e,t){return zt(e,new $e(t))}function wr(e){var t;return(t=Gt(e))===null||t===void 0?void 0:t.spanContext()}var Ti=/^([0-9a-f]{32})$/i,Ai=/^[0-9a-f]{16}$/i;function Ei(e){return Ti.test(e)&&e!==_r}function Ri(e){return Ai.test(e)&&e!==br}function xr(e){return Ei(e.traceId)&&Ri(e.spanId)}function ji(e){return new $e(e)}var St=vr.getInstance(),Sr=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=St.active());var a=!!n?.root;if(a)return new $e;var s=r&&wr(r);return Ni(s)&&xr(s)?new $e(s):new $e},e.prototype.startActiveSpan=function(t,n,r,a){var s,o,i;if(!(arguments.length<2)){arguments.length===2?i=n:arguments.length===3?(s=n,i=r):(s=n,o=r,i=a);var l=o??St.active(),u=this.startSpan(t,s,l),c=zt(l,u);return St.with(c,i,void 0,u)}},e}();function Ni(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Ci=new Sr,Pi=function(){function e(t,n,r,a){this._provider=t,this.name=n,this.version=r,this.options=a}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,a){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Ci},e}(),Oi=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new Sr},e}(),Mi=new Oi,hn=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var a;return(a=this.getDelegateTracer(t,n,r))!==null&&a!==void 0?a:new Pi(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Mi},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,n,r)},e}(),ct;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(ct||(ct={}));var It="trace",$i=function(){function e(){this._proxyTracerProvider=new hn,this.wrapSpanContext=ji,this.isSpanContextValid=xr,this.deleteSpan=Ii,this.getSpan=Gt,this.getActiveSpan=Si,this.getSpanContext=wr,this.setSpan=zt,this.setSpanContext=ki}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=Jt(It,this._proxyTracerProvider,ut.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return Ge(It)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){Zt(It,ut.instance()),this._proxyTracerProvider=new hn},e}(),Di=$i.getInstance(),qi=Object.defineProperty,Ht=(e,t)=>{for(var n in t)qi(e,n,{get:t[n],enumerable:!0})};function Wt(e,{contentType:t,dataStreamVersion:n}){const r=new Headers(e??{});return r.has("Content-Type")||r.set("Content-Type",t),n!==void 0&&r.set("X-Vercel-AI-Data-Stream",n),r}var Ir="AI_InvalidArgumentError",kr=`vercel.ai.error.${Ir}`,Ui=Symbol.for(kr),Tr,$=class extends N{constructor({parameter:e,value:t,message:n}){super({name:Ir,message:`Invalid argument for parameter ${e}: ${n}`}),this[Tr]=!0,this.parameter=e,this.value=t}static isInstance(e){return N.hasMarker(e,kr)}};Tr=Ui;var Ar="AI_RetryError",Er=`vercel.ai.error.${Ar}`,Fi=Symbol.for(Er),Rr,gn=class extends N{constructor({message:e,reason:t,errors:n}){super({name:Ar,message:e}),this[Rr]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return N.hasMarker(e,Er)}};Rr=Fi;var Li=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2}={})=>async r=>jr(r,{maxRetries:e,delayInMs:t,backoffFactor:n});async function jr(e,{maxRetries:t,delayInMs:n,backoffFactor:r},a=[]){try{return await e()}catch(s){if(et(s)||t===0)throw s;const o=Da(s),i=[...a,s],l=i.length;if(l>t)throw new gn({message:`Failed after ${l} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(s instanceof Error&&X.isInstance(s)&&s.isRetryable===!0&&l<=t)return await Oa(n),jr(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r},i);throw l===1?s:new gn({message:`Failed after ${l} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function Bi({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new $({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new $({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return{maxRetries:t,retry:Li({maxRetries:t})}}function kt({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Ji({model:e,settings:t,telemetry:n,headers:r}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((s,[o,i])=>(s[`ai.settings.${o}`]=i,s),{}),...Object.entries((a=n?.metadata)!=null?a:{}).reduce((s,[o,i])=>(s[`ai.telemetry.metadata.${o}`]=i,s),{}),...Object.entries(r??{}).reduce((s,[o,i])=>(i!==void 0&&(s[`ai.request.headers.${o}`]=i),s),{})}}var Zi={startSpan(){return Qe},startActiveSpan(e,t,n,r){if(typeof t=="function")return t(Qe);if(typeof n=="function")return n(Qe);if(typeof r=="function")return r(Qe)}},Qe={spanContext(){return Vi},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Vi={traceId:"",spanId:"",traceFlags:0};function Gi({isEnabled:e=!1,tracer:t}={}){return e?t||Di.getTracer("ai"):Zi}function Tt({name:e,tracer:t,attributes:n,fn:r,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:n},async s=>{try{const o=await r(s);return a&&s.end(),o}catch(o){try{o instanceof Error?(s.recordException({name:o.name,message:o.message,stack:o.stack}),s.setStatus({code:ct.ERROR,message:o.message})):s.setStatus({code:ct.ERROR})}finally{s.end()}throw o}})}function Te({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((n,[r,a])=>{if(a===void 0)return n;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if(e?.recordInputs===!1)return n;const s=a.input();return s===void 0?n:{...n,[r]:s}}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if(e?.recordOutputs===!1)return n;const s=a.output();return s===void 0?n:{...n,[r]:s}}return{...n,[r]:a}},{})}var zi=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],Hi=e=>{const t=typeof e=="string"?Lt(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function Wi(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Hi(e):e}function Ki({data:e,signatures:t}){const n=Wi(e);for(const r of t)if(typeof n=="string"?n.startsWith(r.base64Prefix):n.length>=r.bytesPrefix.length&&r.bytesPrefix.every((a,s)=>n[s]===a))return r.mimeType}var Nr="AI_NoObjectGeneratedError",Cr=`vercel.ai.error.${Nr}`,Yi=Symbol.for(Cr),Pr,he=class extends N{constructor({message:e="No object generated.",cause:t,text:n,response:r,usage:a,finishReason:s}){super({name:Nr,message:e,cause:t}),this[Pr]=!0,this.text=n,this.response=r,this.usage=a,this.finishReason=s}static isInstance(e){return N.hasMarker(e,Cr)}};Pr=Yi;var Or="AI_DownloadError",Mr=`vercel.ai.error.${Or}`,Qi=Symbol.for(Mr),$r,At=class extends N{constructor({url:e,statusCode:t,statusText:n,cause:r,message:a=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:Or,message:a,cause:r}),this[$r]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return N.hasMarker(e,Mr)}};$r=Qi;async function Xi({url:e}){var t;const n=e.toString();try{const r=await fetch(n);if(!r.ok)throw new At({url:n,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mimeType:(t=r.headers.get("content-type"))!=null?t:void 0}}catch(r){throw At.isInstance(r)?r:new At({url:n,cause:r})}}var Dr="AI_InvalidDataContentError",qr=`vercel.ai.error.${Dr}`,el=Symbol.for(qr),Ur,yn=class extends N{constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Dr,message:n,cause:t}),this[Ur]=!0,this.content=e}static isInstance(e){return N.hasMarker(e,qr)}};Ur=el;var Fr=B([d(),tt(Uint8Array),tt(ArrayBuffer),ea(e=>{var t,n;return(n=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?n:!1},{message:"Must be a Buffer"})]);function Kt(e){return typeof e=="string"?e:e instanceof ArrayBuffer?st(new Uint8Array(e)):st(e)}function pt(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Lt(e)}catch(t){throw new yn({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new yn({content:e})}function tl(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var Lr="AI_InvalidMessageRoleError",Br=`vercel.ai.error.${Lr}`,nl=Symbol.for(Br),Jr,rl=class extends N{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Lr,message:t}),this[Jr]=!0,this.role=e}static isInstance(e){return N.hasMarker(e,Br)}};Jr=nl;function al(e){try{const[t,n]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:n}}catch{return{mimeType:void 0,base64Content:void 0}}}async function vn({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:n=()=>!1,downloadImplementation:r=Xi}){const a=await ol(e.messages,r,t,n);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(s=>sl(s,a))]}function sl(e,t){var n,r,a,s,o,i;const l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata}:{role:"user",content:e.content.map(u=>il(u,t)).filter(u=>u.type!=="text"||u.text!==""),providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(u=>u.type!=="text"||u.text!=="").map(u=>{var c;const p=(c=u.providerOptions)!=null?c:u.experimental_providerMetadata;switch(u.type){case"file":return{type:"file",data:u.data instanceof URL?u.data:Kt(u.data),filename:u.filename,mimeType:u.mimeType,providerMetadata:p};case"reasoning":return{type:"reasoning",text:u.text,signature:u.signature,providerMetadata:p};case"redacted-reasoning":return{type:"redacted-reasoning",data:u.data,providerMetadata:p};case"text":return{type:"text",text:u.text,providerMetadata:p};case"tool-call":return{type:"tool-call",toolCallId:u.toolCallId,toolName:u.toolName,args:u.args,providerMetadata:p}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(u=>{var c;return{type:"tool-result",toolCallId:u.toolCallId,toolName:u.toolName,result:u.result,content:u.experimental_content,isError:u.isError,providerMetadata:(c=u.providerOptions)!=null?c:u.experimental_providerMetadata}}),providerMetadata:(i=e.providerOptions)!=null?i:e.experimental_providerMetadata};default:{const u=l;throw new rl({role:u})}}}async function ol(e,t,n,r){const a=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&n===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!r(o)),s=await Promise.all(a.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(s.map(({url:o,data:i})=>[o.toString(),i]))}function il(e,t){var n,r,a,s;if(e.type==="text")return{type:"text",text:e.text,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};let o=e.mimeType,i,l,u;const c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{l=typeof i=="string"?new URL(i):i}catch{l=i}if(l instanceof URL)if(l.protocol==="data:"){const{mimeType:p,base64Content:f}=al(l.toString());if(p==null||f==null)throw new Error(`Invalid data URL format in part ${c}`);o=p,u=pt(f)}else{const p=t[l.toString()];p?(u=p.data,o??(o=p.mimeType)):u=l}else u=pt(l);switch(c){case"image":return u instanceof Uint8Array&&(o=(r=Ki({data:u,signatures:zi}))!=null?r:o),{type:"image",image:u,mimeType:o,providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case"file":{if(o==null)throw new Error("Mime type is missing for file part");return{type:"file",data:u instanceof Uint8Array?Kt(u):u,filename:e.filename,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}}}}function bn({maxTokens:e,temperature:t,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o,seed:i}){if(e!=null){if(!Number.isInteger(e))throw new $({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new $({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new $({parameter:"temperature",value:t,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new $({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new $({parameter:"topK",value:r,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new $({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new $({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new $({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o!=null&&o.length>0?o:void 0,seed:i}}function _n(e){var t,n,r;const a=[];for(const s of e){let o;try{o=new URL(s.url)}catch{throw new Error(`Invalid URL: ${s.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=s.contentType)!=null&&t.startsWith("image/"))a.push({type:"image",image:o});else{if(!s.contentType)throw new Error("If the attachment is not an image, it must specify a content type");a.push({type:"file",data:o,mimeType:s.contentType})}break}case"data:":{let i,l,u;try{[i,l]=s.url.split(","),u=i.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${s.url}`)}if(u==null||l==null)throw new Error(`Invalid data URL format: ${s.url}`);if((n=s.contentType)!=null&&n.startsWith("image/"))a.push({type:"image",image:pt(l)});else if((r=s.contentType)!=null&&r.startsWith("text/"))a.push({type:"text",text:tl(pt(l))});else{if(!s.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");a.push({type:"file",data:l,mimeType:s.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return a}var Zr="AI_MessageConversionError",Vr=`vercel.ai.error.${Zr}`,ll=Symbol.for(Vr),Gr,Et=class extends N{constructor({originalMessage:e,message:t}){super({name:Zr,message:t}),this[Gr]=!0,this.originalMessage=e}static isInstance(e){return N.hasMarker(e,Vr)}};Gr=ll;function ul(e,t){var n,r;const a=(n=t?.tools)!=null?n:{},s=[];for(let o=0;o<e.length;o++){const i=e[o],l=o===e.length-1,{role:u,content:c,experimental_attachments:p}=i;switch(u){case"system":{s.push({role:"system",content:c});break}case"user":{if(i.parts==null)s.push({role:"user",content:p?[{type:"text",text:c},..._n(p)]:c});else{const f=i.parts.filter(w=>w.type==="text").map(w=>({type:"text",text:w.text}));s.push({role:"user",content:p?[...f,..._n(p)]:f})}break}case"assistant":{if(i.parts!=null){let y=function(){const _=[];for(const x of h)switch(x.type){case"file":case"text":{_.push(x);break}case"reasoning":{for(const A of x.details)switch(A.type){case"text":_.push({type:"reasoning",text:A.text,signature:A.signature});break;case"redacted":_.push({type:"redacted-reasoning",data:A.data});break}break}case"tool-invocation":_.push({type:"tool-call",toolCallId:x.toolInvocation.toolCallId,toolName:x.toolInvocation.toolName,args:x.toolInvocation.args});break;default:{const A=x;throw new Error(`Unsupported part: ${A}`)}}s.push({role:"assistant",content:_});const k=h.filter(x=>x.type==="tool-invocation").map(x=>x.toolInvocation);k.length>0&&s.push({role:"tool",content:k.map(x=>{if(!("result"in x))throw new Et({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(x)});const{toolCallId:A,toolName:C,result:J}=x,S=a[C];return S?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:A,toolName:C,result:S.experimental_toToolResultContent(J),experimental_content:S.experimental_toToolResultContent(J)}:{type:"tool-result",toolCallId:A,toolName:C,result:J}})}),h=[],g=!1,v++},v=0,g=!1,h=[];for(const _ of i.parts)switch(_.type){case"text":{g&&y(),h.push(_);break}case"file":case"reasoning":{h.push(_);break}case"tool-invocation":{((r=_.toolInvocation.step)!=null?r:0)!==v&&y(),h.push(_),g=!0;break}}y();break}const f=i.toolInvocations;if(f==null||f.length===0){s.push({role:"assistant",content:c});break}const w=f.reduce((y,v)=>{var g;return Math.max(y,(g=v.step)!=null?g:0)},0);for(let y=0;y<=w;y++){const v=f.filter(g=>{var h;return((h=g.step)!=null?h:0)===y});v.length!==0&&(s.push({role:"assistant",content:[...l&&c&&y===0?[{type:"text",text:c}]:[],...v.map(({toolCallId:g,toolName:h,args:_})=>({type:"tool-call",toolCallId:g,toolName:h,args:_}))]}),s.push({role:"tool",content:v.map(g=>{if(!("result"in g))throw new Et({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(g)});const{toolCallId:h,toolName:_,result:k}=g,x=a[_];return x?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:h,toolName:_,result:x.experimental_toToolResultContent(k),experimental_content:x.experimental_toToolResultContent(k)}:{type:"tool-result",toolCallId:h,toolName:_,result:k}})}))}c&&!l&&s.push({role:"assistant",content:c});break}case"data":break;default:{const f=u;throw new Et({originalMessage:i,message:`Unsupported role: ${f}`})}}}return s}var Mt=ta(()=>B([na(),d(),I(),le(),De(d(),Mt),j(Mt)])),q=De(d(),De(d(),Mt)),cl=j(B([m({type:T("text"),text:d()}),m({type:T("image"),data:d(),mimeType:d().optional()})])),zr=m({type:T("text"),text:d(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),pl=m({type:T("image"),image:B([Fr,tt(URL)]),mimeType:d().optional(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),Hr=m({type:T("file"),data:B([Fr,tt(URL)]),filename:d().optional(),mimeType:d(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),dl=m({type:T("reasoning"),text:d(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),ml=m({type:T("redacted-reasoning"),data:d(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),fl=m({type:T("tool-call"),toolCallId:d(),toolName:d(),args:ft(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),hl=m({type:T("tool-result"),toolCallId:d(),toolName:d(),result:ft(),content:cl.optional(),isError:le().optional(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),gl=m({role:T("system"),content:d(),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),yl=m({role:T("user"),content:B([d(),j(B([zr,pl,Hr]))]),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),vl=m({role:T("assistant"),content:B([d(),j(B([zr,Hr,dl,ml,fl]))]),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),bl=m({role:T("tool"),content:j(hl),providerOptions:q.optional(),experimental_providerMetadata:q.optional()}),_l=B([gl,yl,vl,bl]);function wn({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new de({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new de({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new de({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new de({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const r=wl(e.messages)==="ui-messages"?ul(e.messages,{tools:t}):e.messages;if(r.length===0)throw new de({prompt:e,message:"messages must not be empty"});const a=ge({value:r,schema:j(_l)});if(!a.success)throw new de({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${a.error.message}`].join(`
`),cause:a.error});return{type:"messages",messages:r,system:e.system}}throw new Error("unreachable")}function wl(e){if(!Array.isArray(e))throw new de({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return"messages";const t=e.map(xl);if(t.some(r=>r==="has-ui-specific-parts"))return"ui-messages";const n=t.findIndex(r=>r!=="has-core-specific-parts"&&r!=="message");if(n===-1)return"messages";throw new de({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[n]}" at index ${n}`,`messages[${n}]: ${JSON.stringify(e[n])}`].join(`
`),cause:e})}function xl(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Ae({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}var Sl="JSON schema:",Il="You MUST answer with a JSON object that matches the JSON schema above.",kl="You MUST answer with JSON.";function $t({prompt:e,schema:t,schemaPrefix:n=t!=null?Sl:void 0,schemaSuffix:r=t!=null?Il:kl}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,n,t!=null?JSON.stringify(t):void 0,r].filter(a=>a!=null).join(`
`)}function Tl(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const n=t.getReader();return{async next(){const{done:r,value:a}=await n.read();return r?{done:!0,value:void 0}:{done:!1,value:a}}}},t}var Al={type:"no-schema",jsonSchema:void 0,validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},validateFinalResult(e,t){return e===void 0?{success:!1,error:new he({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new U({functionality:"element streams in no-schema mode"})}},El=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult({value:t,textDelta:n}){return{success:!0,value:{partial:t,textDelta:n}}},validateFinalResult(t){return ge({value:t,schema:e})},createElementStream(){throw new U({functionality:"element streams in object mode"})}}),Rl=e=>{const{$schema:t,...n}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:n}},required:["elements"],additionalProperties:!1},validatePartialResult({value:r,latestObject:a,isFirstDelta:s,isFinalDelta:o}){var i;if(!jt(r)||!rn(r.elements))return{success:!1,error:new me({value:r,cause:"value must be an object that contains an array of elements"})};const l=r.elements,u=[];for(let f=0;f<l.length;f++){const w=l[f],y=ge({value:w,schema:e});if(!(f===l.length-1&&!o)){if(!y.success)return y;u.push(y.value)}}const c=(i=a?.length)!=null?i:0;let p="";return s&&(p+="["),c>0&&(p+=","),p+=u.slice(c).map(f=>JSON.stringify(f)).join(","),o&&(p+="]"),{success:!0,value:{partial:u,textDelta:p}}},validateFinalResult(r){if(!jt(r)||!rn(r.elements))return{success:!1,error:new me({value:r,cause:"value must be an object that contains an array of elements"})};const a=r.elements;for(const s of a){const o=ge({value:s,schema:e});if(!o.success)return o}return{success:!0,value:a}},createElementStream(r){let a=0;return Tl(r.pipeThrough(new TransformStream({transform(s,o){switch(s.type){case"object":{const i=s.object;for(;a<i.length;a++)o.enqueue(i[a]);break}case"text-delta":case"finish":case"error":break;default:{const i=s;throw new Error(`Unsupported chunk type: ${i}`)}}}})))}}},jl=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!jt(t)||typeof t.result!="string")return{success:!1,error:new me({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const n=t.result;return e.includes(n)?{success:!0,value:n}:{success:!1,error:new me({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new U({functionality:"partial results in enum mode"})},createElementStream(){throw new U({functionality:"element streams in enum mode"})}});function Nl({output:e,schema:t,enumValues:n}){switch(e){case"object":return El(Pt(t));case"array":return Rl(Pt(t));case"enum":return jl(n);case"no-schema":return Al;default:{const r=e;throw new Error(`Unsupported output: ${r}`)}}}function Cl({output:e,mode:t,schema:n,schemaName:r,schemaDescription:a,enumValues:s}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new $({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t==="auto"||t==="tool")throw new $({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(n!=null)throw new $({parameter:"schema",value:n,message:"Schema is not supported for no-schema output."});if(a!=null)throw new $({parameter:"schemaDescription",value:a,message:"Schema description is not supported for no-schema output."});if(r!=null)throw new $({parameter:"schemaName",value:r,message:"Schema name is not supported for no-schema output."});if(s!=null)throw new $({parameter:"enumValues",value:s,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(n==null)throw new $({parameter:"schema",value:n,message:"Schema is required for object output."});if(s!=null)throw new $({parameter:"enumValues",value:s,message:"Enum values are not supported for object output."})}if(e==="array"){if(n==null)throw new $({parameter:"schema",value:n,message:"Element schema is required for array output."});if(s!=null)throw new $({parameter:"enumValues",value:s,message:"Enum values are not supported for array output."})}if(e==="enum"){if(n!=null)throw new $({parameter:"schema",value:n,message:"Schema is not supported for enum output."});if(a!=null)throw new $({parameter:"schemaDescription",value:a,message:"Schema description is not supported for enum output."});if(r!=null)throw new $({parameter:"schemaName",value:r,message:"Schema name is not supported for enum output."});if(s==null)throw new $({parameter:"enumValues",value:s,message:"Enum values are required for enum output."});for(const o of s)if(typeof o!="string")throw new $({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}function Pl(e){const t=e.map(n=>({...n,content:typeof n.content=="string"?n.content:n.content.map(Ol)}));return JSON.stringify(t)}function Ol(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?Kt(e.image):e.image}:e}var Ml=Ie({prefix:"aiobj",size:24});async function $l({model:e,enum:t,schema:n,schemaName:r,schemaDescription:a,mode:s,output:o="object",system:i,prompt:l,messages:u,maxRetries:c,abortSignal:p,headers:f,experimental_repairText:w,experimental_telemetry:y,experimental_providerMetadata:v,providerOptions:g=v,_internal:{generateId:h=Ml,currentDate:_=()=>new Date}={},...k}){Cl({output:o,mode:s,schema:n,schemaName:r,schemaDescription:a,enumValues:t});const{maxRetries:x,retry:A}=Bi({maxRetries:c}),C=Nl({output:o,schema:n,enumValues:t});C.type==="no-schema"&&s===void 0&&(s="json");const J=Ji({model:e,telemetry:y,headers:f,settings:{...k,maxRetries:x}}),S=Gi(y);return Tt({name:"ai.generateObject",attributes:Te({telemetry:y,attributes:{...kt({operationId:"ai.generateObject",telemetry:y}),...J,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:l,messages:u})},"ai.schema":C.jsonSchema!=null?{input:()=>JSON.stringify(C.jsonSchema)}:void 0,"ai.schema.name":r,"ai.schema.description":a,"ai.settings.output":C.type,"ai.settings.mode":s}}),tracer:S,fn:async R=>{var pe,ye,ve,re;(s==="auto"||s==null)&&(s=e.defaultObjectGenerationMode);let z,ee,te,ke,D,W,F,M,yt;switch(s){case"json":{const L=wn({prompt:{system:C.jsonSchema==null?$t({prompt:i}):e.supportsStructuredOutputs?i:$t({prompt:i,schema:C.jsonSchema}),prompt:l,messages:u},tools:void 0}),ne=await vn({prompt:L,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(pe=e.supportsUrl)==null?void 0:pe.bind(e)}),G=await A(()=>Tt({name:"ai.generateObject.doGenerate",attributes:Te({telemetry:y,attributes:{...kt({operationId:"ai.generateObject.doGenerate",telemetry:y}),...J,"ai.prompt.format":{input:()=>L.type},"ai.prompt.messages":{input:()=>JSON.stringify(ne)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":k.frequencyPenalty,"gen_ai.request.max_tokens":k.maxTokens,"gen_ai.request.presence_penalty":k.presencePenalty,"gen_ai.request.temperature":k.temperature,"gen_ai.request.top_k":k.topK,"gen_ai.request.top_p":k.topP}}),tracer:S,fn:async ae=>{var Ke,je,Ne,Ce,Pe,Oe;const Z=await e.doGenerate({mode:{type:"object-json",schema:C.jsonSchema,name:r,description:a},...bn(k),inputFormat:L.type,prompt:ne,providerMetadata:g,abortSignal:p,headers:f}),ie={id:(je=(Ke=Z.response)==null?void 0:Ke.id)!=null?je:h(),timestamp:(Ce=(Ne=Z.response)==null?void 0:Ne.timestamp)!=null?Ce:_(),modelId:(Oe=(Pe=Z.response)==null?void 0:Pe.modelId)!=null?Oe:e.modelId};if(Z.text===void 0)throw new he({message:"No object generated: the model did not return a response.",response:ie,usage:Ae(Z.usage),finishReason:Z.finishReason});return ae.setAttributes(Te({telemetry:y,attributes:{"ai.response.finishReason":Z.finishReason,"ai.response.object":{output:()=>Z.text},"ai.response.id":ie.id,"ai.response.model":ie.modelId,"ai.response.timestamp":ie.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Z.providerMetadata),"ai.usage.promptTokens":Z.usage.promptTokens,"ai.usage.completionTokens":Z.usage.completionTokens,"gen_ai.response.finish_reasons":[Z.finishReason],"gen_ai.response.id":ie.id,"gen_ai.response.model":ie.modelId,"gen_ai.usage.prompt_tokens":Z.usage.promptTokens,"gen_ai.usage.completion_tokens":Z.usage.completionTokens}})),{...Z,objectText:Z.text,responseData:ie}}}));z=G.objectText,ee=G.finishReason,te=G.usage,ke=G.warnings,D=G.rawResponse,M=G.logprobs,yt=G.providerMetadata,F=(ye=G.request)!=null?ye:{},W=G.responseData;break}case"tool":{const L=wn({prompt:{system:i,prompt:l,messages:u},tools:void 0}),ne=await vn({prompt:L,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(ve=e.supportsUrl)==null?void 0:ve.bind(e)}),G=L.type,ae=await A(()=>Tt({name:"ai.generateObject.doGenerate",attributes:Te({telemetry:y,attributes:{...kt({operationId:"ai.generateObject.doGenerate",telemetry:y}),...J,"ai.prompt.format":{input:()=>G},"ai.prompt.messages":{input:()=>Pl(ne)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":k.frequencyPenalty,"gen_ai.request.max_tokens":k.maxTokens,"gen_ai.request.presence_penalty":k.presencePenalty,"gen_ai.request.temperature":k.temperature,"gen_ai.request.top_k":k.topK,"gen_ai.request.top_p":k.topP}}),tracer:S,fn:async Ke=>{var je,Ne,Ce,Pe,Oe,Z,ie,tn;const K=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:r??"json",description:a??"Respond with a JSON object.",parameters:C.jsonSchema}},...bn(k),inputFormat:G,prompt:ne,providerMetadata:g,abortSignal:p,headers:f}),vt=(Ne=(je=K.toolCalls)==null?void 0:je[0])==null?void 0:Ne.args,be={id:(Pe=(Ce=K.response)==null?void 0:Ce.id)!=null?Pe:h(),timestamp:(Z=(Oe=K.response)==null?void 0:Oe.timestamp)!=null?Z:_(),modelId:(tn=(ie=K.response)==null?void 0:ie.modelId)!=null?tn:e.modelId};if(vt===void 0)throw new he({message:"No object generated: the tool was not called.",response:be,usage:Ae(K.usage),finishReason:K.finishReason});return Ke.setAttributes(Te({telemetry:y,attributes:{"ai.response.finishReason":K.finishReason,"ai.response.object":{output:()=>vt},"ai.response.id":be.id,"ai.response.model":be.modelId,"ai.response.timestamp":be.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(K.providerMetadata),"ai.usage.promptTokens":K.usage.promptTokens,"ai.usage.completionTokens":K.usage.completionTokens,"gen_ai.response.finish_reasons":[K.finishReason],"gen_ai.response.id":be.id,"gen_ai.response.model":be.modelId,"gen_ai.usage.input_tokens":K.usage.promptTokens,"gen_ai.usage.output_tokens":K.usage.completionTokens}})),{...K,objectText:vt,responseData:be}}}));z=ae.objectText,ee=ae.finishReason,te=ae.usage,ke=ae.warnings,D=ae.rawResponse,M=ae.logprobs,yt=ae.providerMetadata,F=(re=ae.request)!=null?re:{},W=ae.responseData;break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const L=s;throw new Error(`Unsupported mode: ${L}`)}}function en(L){const ne=Ee({text:L});if(!ne.success)throw new he({message:"No object generated: could not parse the response.",cause:ne.error,text:L,response:W,usage:Ae(te),finishReason:ee});const G=C.validateFinalResult(ne.value,{text:L,response:W,usage:Ae(te)});if(!G.success)throw new he({message:"No object generated: response did not match schema.",cause:G.error,text:L,response:W,usage:Ae(te),finishReason:ee});return G.value}let We;try{We=en(z)}catch(L){if(w!=null&&he.isInstance(L)&&(qe.isInstance(L.cause)||me.isInstance(L.cause))){const ne=await w({text:z,error:L.cause});if(ne===null)throw L;We=en(ne)}else throw L}return R.setAttributes(Te({telemetry:y,attributes:{"ai.response.finishReason":ee,"ai.response.object":{output:()=>JSON.stringify(We)},"ai.usage.promptTokens":te.promptTokens,"ai.usage.completionTokens":te.completionTokens}})),new Dl({object:We,finishReason:ee,usage:Ae(te),warnings:ke,request:F,response:{...W,headers:D?.headers,body:D?.body},logprobs:M,providerMetadata:yt})}})}var Dl=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e?.status)!=null?t:200,headers:Wt(e?.headers,{contentType:"application/json; charset=utf-8"})})}};Ie({prefix:"aiobj",size:24});Ie({prefix:"aitxt",size:24});Ie({prefix:"msg",size:24});var ql={};Ht(ql,{object:()=>Fl,text:()=>Ul});var Ul=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),Fl=({schema:e})=>{const t=Pt(e);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:r}){return r.supportsStructuredOutputs?n:$t({prompt:n,schema:t.jsonSchema})},parsePartial({text:n}){const r=$o(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const a=r.state;throw new Error(`Unsupported parse state: ${a}`)}}},parseOutput({text:n},r){const a=Ee({text:n});if(!a.success)throw new he({message:"No object generated: could not parse the response.",cause:a.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});const s=ge({value:a.value,schema:t});if(!s.success)throw new he({message:"No object generated: response did not match schema.",cause:s.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};function Wr(e,t){const n=e.getReader(),r=t.getReader();let a,s,o=!1,i=!1;async function l(c){try{a==null&&(a=n.read());const p=await a;a=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}async function u(c){try{s==null&&(s=r.read());const p=await s;s=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}return new ReadableStream({async pull(c){try{if(o){await u(c);return}if(i){await l(c);return}a==null&&(a=n.read()),s==null&&(s=r.read());const{result:p,reader:f}=await Promise.race([a.then(w=>({result:w,reader:n})),s.then(w=>({result:w,reader:r}))]);p.done||c.enqueue(p.value),f===n?(a=void 0,p.done&&(await u(c),o=!0)):(s=void 0,p.done&&(i=!0,await l(c)))}catch(p){c.error(p)}},cancel(){n.cancel(),r.cancel()}})}Ie({prefix:"aitxt",size:24});Ie({prefix:"msg",size:24});var Ll=m({name:d(),version:d()}).passthrough(),Yt=m({_meta:V(m({}).passthrough())}).passthrough(),ze=Yt,Bl=m({method:d(),params:V(Yt)}),Jl=m({experimental:V(m({}).passthrough()),logging:V(m({}).passthrough()),prompts:V(m({listChanged:V(le())}).passthrough()),resources:V(m({subscribe:V(le()),listChanged:V(le())}).passthrough()),tools:V(m({listChanged:V(le())}).passthrough())}).passthrough();ze.extend({protocolVersion:d(),capabilities:Jl,serverInfo:Ll,instructions:V(d())});var Zl=ze.extend({nextCursor:V(d())}),Vl=m({name:d(),description:V(d()),inputSchema:m({type:T("object"),properties:V(m({}).passthrough())}).passthrough()}).passthrough();Zl.extend({tools:j(Vl)});var Gl=m({type:T("text"),text:d()}).passthrough(),zl=m({type:T("image"),data:d().base64(),mimeType:d()}).passthrough(),Kr=m({uri:d(),mimeType:V(d())}).passthrough(),Hl=Kr.extend({text:d()}),Wl=Kr.extend({blob:d().base64()}),Kl=m({type:T("resource"),resource:B([Hl,Wl])}).passthrough();ze.extend({content:j(B([Gl,zl,Kl])),isError:le().default(!1).optional()}).or(ze.extend({toolResult:ft()}));var gt="2.0",Yl=m({jsonrpc:T(gt),id:B([d(),I().int()])}).merge(Bl).strict(),Ql=m({jsonrpc:T(gt),id:B([d(),I().int()]),result:ze}).strict(),Xl=m({jsonrpc:T(gt),id:B([d(),I().int()]),error:m({code:I().int(),message:d(),data:V(ft())})}).strict(),eu=m({jsonrpc:T(gt)}).merge(m({method:d(),params:V(Yt)})).strict();B([Yl,eu,Ql,Xl]);var tu={};Ht(tu,{mergeIntoDataStream:()=>au,toDataStream:()=>nu,toDataStreamResponse:()=>ru});function Yr(e={}){const t=new TextEncoder;let n="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(r,a){a.enqueue(t.encode(r)),n+=r,e.onToken&&await e.onToken(r),e.onText&&typeof r=="string"&&await e.onText(r)},async flush(){e.onCompletion&&await e.onCompletion(n),e.onFinal&&await e.onFinal(n)}})}function Qt(e,t){return e.pipeThrough(new TransformStream({transform:async(n,r)=>{var a;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&xn((a=n.data)==null?void 0:a.chunk,r);return}xn(n,r)}})).pipeThrough(Yr(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,r)=>{r.enqueue(yr("text",n))}}))}function nu(e,t){return Qt(e,t).pipeThrough(new TextEncoderStream)}function ru(e,t){var n;const r=Qt(e,t?.callbacks).pipeThrough(new TextEncoderStream),a=t?.data,s=t?.init,o=a?Wr(a.stream,r):r;return new Response(o,{status:(n=s?.status)!=null?n:200,statusText:s?.statusText,headers:Wt(s?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function au(e,t){t.dataStream.merge(Qt(e,t.callbacks))}function xn(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const n=e.content;for(const r of n)r.type==="text"&&t.enqueue(r.text)}}var su={};Ht(su,{mergeIntoDataStream:()=>lu,toDataStream:()=>ou,toDataStreamResponse:()=>iu});function Xt(e,t){const n=uu();return Pa(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(r,a){a.enqueue(n(r.delta))}})).pipeThrough(Yr(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,a)=>{a.enqueue(yr("text",r))}}))}function ou(e,t){return Xt(e,t).pipeThrough(new TextEncoderStream)}function iu(e,t={}){var n;const{init:r,data:a,callbacks:s}=t,o=Xt(e,s).pipeThrough(new TextEncoderStream),i=a?Wr(a.stream,o):o;return new Response(i,{status:(n=r?.status)!=null?n:200,statusText:r?.statusText,headers:Wt(r?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function lu(e,t){t.dataStream.merge(Xt(e,t.callbacks))}function uu(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}const cu=`You are a helpful assistant who is familiar with software engineering using Supabase. You are provided with sets of documents. For each set, you will be asked to generate two sets of questions:

1. Answerable questions: questions that can be answered by the documents.
2. Non-answerable questions: questions that cannot be answered by the documents.

Before generating any questions, evaluate each documentation carefully to determine what information it contains. Generate a range of answerable questions, including questions that are obviously answerable, and questions that require a deeper understanding of the content in one or several of the documents. Generate a range of non-answerable questions that differ from each other, but make them all related to software engineering using Supabase.

Return your response as a JSON object with exactly two fields:
- 'answerable': an array of answerable question strings
- 'nonAnswerable': an array of non-answerable question strings

## Example

### Example documents

Document 1 (ID: 1):
Title: Supabase overview
Content: Supabase is a modern, open-source database platform that provides a comprehensive set of tools for building web and mobile applications. It offers a range of features, including real-time data synchronization, authentication, and storage.

Document 2 (ID: 2):
Title: Supabase authentication
Content: Supabase provides a range of authentication options, including email/password, social login (Google, GitHub, etc.), and magic links. It also supports multi-factor authentication (MFA) for enhanced security.

### Example output

{
  "answerable": ["What is Supabase?", "How can I secure user logins using Supabase?"],
  "nonAnswerable": ["How do you deploy to AWS Lambda?", "How do I add a new column to a table in Postgres?"]
}`,pu=m({answerable:j(d()),nonAnswerable:j(d())});async function du(e,t,n){const{answerableCount:r,nonAnswerableCount:a}=t,s=e.map((i,l)=>`Document ${l+1} (ID: ${i.id}):
Title: ${i.title}
Content: ${i.content}...
`).join(`
`),o=`Here are the documents. Generate ${r} answerable and ${a} non-answerable questions.

Documents:
${s}`;try{const i=cr({apiKey:n}),l=await $l({model:i.chat("gpt-4o"),schema:pu,messages:[{role:"system",content:cu},{role:"user",content:o}]});return nt.ok(l.object)}catch(i){return nt.err(new kn("AI question generation failed",i))}}function mu(e){const[t,n]=Xe.useState(12),[r,a]=Xe.useState(8),[s,o]=Xe.useState([]),{data:i="",isLoading:l}=ra(),{data:u,isLoading:c,isError:p}=dt({queryKey:["document-sample",e],queryFn:async()=>await Se.getDocumentSample(e)??null}),f=In({mutationFn:async()=>{if(!i)throw new Error("Missing OpenAI API key. Configure your API key in Settings.");const w=await Se.getDocumentSample(e);if(!w)throw new Error(`Expected to find sample for ID ${e} but none found`);const{answerable:y,nonAnswerable:v}=(await du(w.documents,{answerableCount:t,nonAnswerableCount:r},i)).unwrapRaw(),g=y.map(_=>({id:crypto.randomUUID(),text:_,type:"answerable",status:"pending",generatedBy:"llm"})),h=v.map(_=>({id:crypto.randomUUID(),text:_,type:"non-answerable",status:"pending",generatedBy:"llm"}));o([...g,...h])}});return{answerableCount:t,setAnswerableCount:n,nonAnswerableCount:r,setNonAnswerableCount:a,questions:s,setQuestions:o,apiKey:i,apiKeyLoading:l,sampleLoading:c,sampleError:p,generateMutation:f,sample:u}}function fu({questions:e,sampleId:t,setSaveSuccess:n}){const r=aa();return In({mutationFn:async()=>{try{return await Promise.all(e.filter(s=>s.status==="accepted").map(async s=>{await Se.saveQuestion({...s,createdAt:new Date,updatedAt:new Date,documentSampleId:t})})),nt.ok(void 0)}catch(s){return nt.err(new kn("Failed to save questions",s))}},onSuccess:s=>{s.isOk()&&(n(!0),setTimeout(()=>n(!1),2e3),r.invalidateQueries({queryKey:["questions",t]}))}})}const hu=({sampleId:e})=>{const{answerableCount:t,setAnswerableCount:n,nonAnswerableCount:r,setNonAnswerableCount:a,questions:s,apiKey:o,apiKeyLoading:i,sampleLoading:l,sampleError:u,generateMutation:c,sample:p}=mu(e),[f,w]=Xe.useState(!1),y=fu({questions:s,sampleId:e,setSaveSuccess:w}),v=s.length>0&&s.every(g=>g.status==="accepted"||g.status==="rejected");return b.jsxs("div",{className:"flex gap-10 p-8 bg-muted/50",children:[b.jsx("div",{className:"flex-1 min-w-0",children:b.jsxs("div",{className:"max-w-2xl mx-auto",children:[b.jsxs("div",{className:"bg-card rounded-xl shadow-lg p-8 mb-8 border border-border",children:[b.jsx("h2",{className:"text-2xl font-bold mb-4 text-card-foreground",children:"Generate AI Questions"}),b.jsx(pa,{answerableCount:t,setAnswerableCount:n,nonAnswerableCount:r,setNonAnswerableCount:a,apiKey:o,apiKeyLoading:i,onGenerate:()=>c.mutate(),isGenerating:c.isPending}),c.isError&&b.jsx("div",{className:"text-destructive mb-2",children:c.error instanceof Error?c.error.message:String(c.error)}),b.jsx(ca,{sampleId:e})]}),b.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[b.jsx("button",{type:"button",className:`px-6 py-2 rounded-md font-semibold shadow transition text-white ${v?"bg-primary hover:bg-primary/90":"bg-muted cursor-not-allowed"}`,disabled:!v||y.isPending,onClick:()=>y.mutate(),children:y.isPending?"Saving...":"Save Questions"}),f&&b.jsx("span",{className:"text-green-600 dark:text-green-400 font-medium",children:"Questions saved!"}),y.isError&&b.jsx("span",{className:"text-destructive text-sm",children:y.error instanceof Error?y.error.message:String(y.error)}),!v&&s.length>0&&b.jsx("span",{className:"text-sm text-muted-foreground",children:"All questions must be reviewed before saving."})]}),b.jsx(ma,{sampleId:e})]})}),b.jsx("aside",{className:"w-96 shrink-0",children:b.jsx("div",{className:"sticky top-8",children:b.jsxs("div",{className:"bg-card rounded-xl shadow-lg border border-border p-6",children:[b.jsx("h3",{className:"font-semibold text-lg mb-2 text-card-foreground",children:"Document Sample"}),l?b.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading sample..."}):u?b.jsx("div",{className:"text-xs text-destructive",children:"Error loading sample."}):p?b.jsxs("div",{children:[b.jsx("div",{className:"font-bold mb-1 text-base text-foreground",children:p.name}),b.jsx("div",{className:"text-xs text-muted-foreground mb-4",children:p.description}),b.jsx("ul",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:p.documents.map(g=>b.jsxs("li",{className:"border border-border rounded-lg p-3 bg-muted/30 hover:bg-muted/50 transition",children:[b.jsx("div",{className:"font-medium text-sm mb-1 text-foreground truncate",children:g.title}),b.jsx("div",{className:"text-xs text-primary mb-1 capitalize",children:g.contentType}),b.jsxs("div",{className:"text-xs text-muted-foreground line-clamp-4 whitespace-pre-line",children:[g.content.slice(0,240),g.content.length>240?"...":""]})]},g.id))})]}):b.jsx("div",{className:"text-xs text-muted-foreground",children:"No sample found."})]})})})]})},bu=()=>{const{sample:e}=sa.useSearch(),{data:t,isLoading:n,isError:r,error:a}=dt({queryKey:["validate-sample",e],enabled:!!e,queryFn:async()=>{if(!e)return!1;try{return!!await Se.getDocumentSample(e)}catch(s){throw s instanceof Error?s:new la("Unknown error",s)}}});return e?n?b.jsx("div",{className:"p-4 text-foreground",children:"Loading..."}):r||t===!1?b.jsxs("div",{className:"p-4",children:[b.jsx("div",{className:"text-destructive mb-2",children:a instanceof Error?a.message:"Invalid sample ID. Please select a valid sample."}),b.jsx(nn,{})]}):b.jsx(hu,{sampleId:e}):b.jsx(nn,{})};export{bu as component};
