import{F as j,v as st}from"./index-Dt7WuvF_.js";const Te=(e,t)=>t.some(r=>e instanceof r);let it,nt;function Yt(){return it||(it=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xt(){return nt||(nt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Le=new WeakMap,Ie=new WeakMap,Ve=new WeakMap;function Gt(e){const t=new Promise((r,s)=>{const u=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{r(ie(e.result)),u()},a=()=>{s(e.error),u()};e.addEventListener("success",o),e.addEventListener("error",a)});return Ve.set(t,e),t}function er(e){if(Le.has(e))return;const t=new Promise((r,s)=>{const u=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{r(),u()},a=()=>{s(e.error||new DOMException("AbortError","AbortError")),u()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});Le.set(e,t)}let Be={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Le.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ie(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function St(e){Be=e(Be)}function tr(e){return Xt().includes(e)?function(...t){return e.apply(Me(this),t),ie(this.request)}:function(...t){return ie(e.apply(Me(this),t))}}function rr(e){return typeof e=="function"?tr(e):(e instanceof IDBTransaction&&er(e),Te(e,Yt())?new Proxy(e,Be):e)}function ie(e){if(e instanceof IDBRequest)return Gt(e);if(Ie.has(e))return Ie.get(e);const t=rr(e);return t!==e&&(Ie.set(e,t),Ve.set(t,e)),t}const Me=e=>Ve.get(e);function ot(e,t,{blocked:r,upgrade:s,blocking:u,terminated:o}={}){const a=indexedDB.open(e,t),l=ie(a);return s&&a.addEventListener("upgradeneeded",v=>{s(ie(a.result),v.oldVersion,v.newVersion,ie(a.transaction),v)}),r&&a.addEventListener("blocked",v=>r(v.oldVersion,v.newVersion,v)),l.then(v=>{o&&v.addEventListener("close",()=>o()),u&&v.addEventListener("versionchange",w=>u(w.oldVersion,w.newVersion,w))}).catch(()=>{}),l}const sr=["get","getKey","getAll","getAllKeys","count"],ir=["put","add","delete","clear"],Pe=new Map;function at(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Pe.get(t))return Pe.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,u=ir.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(u||sr.includes(r)))return;const o=async function(a,...l){const v=this.transaction(a,u?"readwrite":"readonly");let w=v.store;return s&&(w=w.index(l.shift())),(await Promise.all([w[r](...l),u&&v.done]))[0]};return Pe.set(t,o),o}St(e=>({...e,get:(t,r,s)=>at(t,r)||e.get(t,r,s),has:(t,r)=>!!at(t,r)||e.has(t,r)}));const nr=["continue","continuePrimaryKey","advance"],ut={},Ne=new WeakMap,xt=new WeakMap,or={get(e,t){if(!nr.includes(t))return e[t];let r=ut[t];return r||(r=ut[t]=function(...s){Ne.set(this,xt.get(this)[t](...s))}),r}};async function*ar(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,or);for(xt.set(r,t),Ve.set(r,Me(t));t;)yield r,t=await(Ne.get(r)||t.continue()),Ne.delete(r)}function ct(e,t){return t===Symbol.asyncIterator&&Te(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Te(e,[IDBIndex,IDBObjectStore])}St(e=>({...e,get(t,r,s){return ct(t,r)?ar:e.get(t,r,s)},has(t,r){return ct(t,r)||e.has(t,r)}}));class ur{db=null;async init(){let t=[];try{const r=await ot("metrick-rag-evals",2);r.objectStoreNames.contains("questions")&&(t=await r.getAll("questions")),r.close()}catch{}if(this.db=await ot("metrick-rag-evals",3,{upgrade(r,s){if(s<3){r.objectStoreNames.contains("questions")&&r.deleteObjectStore("questions");const u=r.createObjectStore("questions",{keyPath:"id"});u.createIndex("by-type","type"),u.createIndex("by-documentSampleId","documentSampleId")}r.objectStoreNames.contains("documentSamples")||r.createObjectStore("documentSamples",{keyPath:"id"}),r.objectStoreNames.contains("annotationSessions")||r.createObjectStore("annotationSessions",{keyPath:"id"})}}),t.length>0&&this.db){const r=this.db.transaction("questions","readwrite");for(const s of t)await r.store.put(s);await r.done}}async saveQuestion(t){return this.db||await this.init(),this.db?.put("questions",t)}async getQuestions(t){return this.db||await this.init(),t?this.db?.getAllFromIndex("questions","by-type",t):this.db?.getAll("questions")}async saveDocumentSample(t){return this.db||await this.init(),this.db?.put("documentSamples",t)}async getDocumentSamples(){return this.db||await this.init(),this.db?.getAll("documentSamples")}async deleteDocumentSample(t){return this.db||await this.init(),this.db?.delete("documentSamples",t)}async saveAnnotationSession(t){return this.db||await this.init(),this.db?.put("annotationSessions",t)}async getAnnotationSessions(){return this.db||await this.init(),this.db?.getAll("annotationSessions")}async getQuestionsByDocumentSample(t){return this.db||await this.init(),this.db?.getAllFromIndex("questions","by-documentSampleId",t)??[]}async updateQuestionStatus(t,r){this.db||await this.init();const s=await this.db?.get("questions",t);return s?(s.status=r,await this.db?.put("questions",s),s):null}async getDocumentSample(t){return this.db||await this.init(),this.db?.get("documentSamples",t)}}const zr=new ur;var ye=e=>e.type==="checkbox",se=e=>e instanceof Date,L=e=>e==null;const kt=e=>typeof e=="object";var k=e=>!L(e)&&!Array.isArray(e)&&kt(e)&&!se(e),cr=e=>k(e)&&e.target?ye(e.target)?e.target.checked:e.target.value:e,lr=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,dr=(e,t)=>e.has(lr(t)),fr=e=>{const t=e.constructor&&e.constructor.prototype;return k(t)&&t.hasOwnProperty("isPrototypeOf")},Re=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function C(e){let t;const r=Array.isArray(e),s=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(Re&&(e instanceof Blob||s))&&(r||k(e)))if(t=r?[]:{},!r&&!fr(e))t=e;else for(const u in e)e.hasOwnProperty(u)&&(t[u]=C(e[u]));else return e;return t}var Ae=e=>/^\w*$/.test(e),O=e=>e===void 0,qe=e=>Array.isArray(e)?e.filter(Boolean):[],ze=e=>qe(e.replace(/["|']|\]/g,"").split(/\.|\[/)),h=(e,t,r)=>{if(!t||!k(e))return r;const s=(Ae(t)?[t]:ze(t)).reduce((u,o)=>L(u)?u:u[o],e);return O(s)||s===e?O(e[t])?r:e[t]:s},H=e=>typeof e=="boolean",D=(e,t,r)=>{let s=-1;const u=Ae(t)?[t]:ze(t),o=u.length,a=o-1;for(;++s<o;){const l=u[s];let v=r;if(s!==a){const w=e[l];v=k(w)||Array.isArray(w)?w:isNaN(+u[s+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;e[l]=v,e=e[l]}};const lt={BLUR:"blur",FOCUS_OUT:"focusout"},R={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Q={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},yr=j.createContext(null);yr.displayName="HookFormContext";var hr=(e,t,r,s=!0)=>{const u={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(u,o,{get:()=>{const a=o;return t._proxyFormState[a]!==R.all&&(t._proxyFormState[a]=!s||R.all),e[a]}});return u};const gr=typeof window<"u"?st.useLayoutEffect:st.useEffect;var Z=e=>typeof e=="string",vr=(e,t,r,s,u)=>Z(e)?(s&&t.watch.add(e),h(r,e,u)):Array.isArray(e)?e.map(o=>(s&&t.watch.add(o),h(r,o))):(s&&(t.watchAll=!0),r),We=(e,t,r,s,u)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[s]:u||!0}}:{},de=e=>Array.isArray(e)?e:[e],dt=()=>{let e=[];return{get observers(){return e},next:u=>{for(const o of e)o.next&&o.next(u)},subscribe:u=>(e.push(u),{unsubscribe:()=>{e=e.filter(o=>o!==u)}}),unsubscribe:()=>{e=[]}}},Ue=e=>L(e)||!kt(e);function te(e,t,r=new WeakSet){if(Ue(e)||Ue(t))return e===t;if(se(e)&&se(t))return e.getTime()===t.getTime();const s=Object.keys(e),u=Object.keys(t);if(s.length!==u.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const o of s){const a=e[o];if(!u.includes(o))return!1;if(o!=="ref"){const l=t[o];if(se(a)&&se(l)||k(a)&&k(l)||Array.isArray(a)&&Array.isArray(l)?!te(a,l,r):a!==l)return!1}}return!0}var M=e=>k(e)&&!Object.keys(e).length,$e=e=>e.type==="file",q=e=>typeof e=="function",we=e=>{if(!Re)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},pt=e=>e.type==="select-multiple",He=e=>e.type==="radio",br=e=>He(e)||ye(e),Ce=e=>we(e)&&e.isConnected;function mr(e,t){const r=t.slice(0,-1).length;let s=0;for(;s<r;)e=O(e)?s++:e[t[s++]];return e}function wr(e){for(const t in e)if(e.hasOwnProperty(t)&&!O(e[t]))return!1;return!0}function p(e,t){const r=Array.isArray(t)?t:Ae(t)?[t]:ze(t),s=r.length===1?e:mr(e,r),u=r.length-1,o=r[u];return s&&delete s[o],u!==0&&(k(s)&&M(s)||Array.isArray(s)&&wr(s))&&p(e,r.slice(0,-1)),e}var Ot=e=>{for(const t in e)if(q(e[t]))return!0;return!1};function _e(e,t={}){const r=Array.isArray(e);if(k(e)||r)for(const s in e)Array.isArray(e[s])||k(e[s])&&!Ot(e[s])?(t[s]=Array.isArray(e[s])?[]:{},_e(e[s],t[s])):L(e[s])||(t[s]=!0);return t}function It(e,t,r){const s=Array.isArray(e);if(k(e)||s)for(const u in e)Array.isArray(e[u])||k(e[u])&&!Ot(e[u])?O(t)||Ue(r[u])?r[u]=Array.isArray(e[u])?_e(e[u],[]):{..._e(e[u])}:It(e[u],L(t)?{}:t[u],r[u]):r[u]=!te(e[u],t[u]);return r}var ce=(e,t)=>It(e,t,_e(t));const ft={value:!1,isValid:!1},yt={value:!0,isValid:!0};var Pt=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!O(e[0].attributes.value)?O(e[0].value)||e[0].value===""?yt:{value:e[0].value,isValid:!0}:yt:ft}return ft},Ct=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:s})=>O(e)?e:t?e===""?NaN:e&&+e:r&&Z(e)?new Date(e):s?s(e):e;const ht={isValid:!1,value:null};var Tt=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,ht):ht;function gt(e){const t=e.ref;return $e(t)?t.files:He(t)?Tt(e.refs).value:pt(t)?[...t.selectedOptions].map(({value:r})=>r):ye(t)?Pt(e.refs).value:Ct(O(t.value)?e.ref.value:t.value,e)}var _r=(e,t,r,s)=>{const u={};for(const o of e){const a=h(t,o);a&&D(u,o,a._f)}return{criteriaMode:r,names:[...e],fields:u,shouldUseNativeValidation:s}},Ee=e=>e instanceof RegExp,le=e=>O(e)?e:Ee(e)?e.source:k(e)?Ee(e.value)?e.value.source:e.value:e,vt=e=>({isOnSubmit:!e||e===R.onSubmit,isOnBlur:e===R.onBlur,isOnChange:e===R.onChange,isOnAll:e===R.all,isOnTouch:e===R.onTouched});const bt="AsyncFunction";var Er=e=>!!e&&!!e.validate&&!!(q(e.validate)&&e.validate.constructor.name===bt||k(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===bt)),Vr=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),mt=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const fe=(e,t,r,s)=>{for(const u of r||Object.keys(e)){const o=h(e,u);if(o){const{_f:a,...l}=o;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],u)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if(fe(l,t))break}else if(k(l)&&fe(l,t))break}}};function wt(e,t,r){const s=h(e,r);if(s||Ae(r))return{error:s,name:r};const u=r.split(".");for(;u.length;){const o=u.join("."),a=h(t,o),l=h(e,o);if(a&&!Array.isArray(a)&&r!==o)return{name:r};if(l&&l.type)return{name:o,error:l};if(l&&l.root&&l.root.type)return{name:`${o}.root`,error:l.root};u.pop()}return{name:r}}var Ar=(e,t,r,s)=>{r(e);const{name:u,...o}=e;return M(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(a=>t[a]===(!s||R.all))},Dr=(e,t,r)=>!e||!t||e===t||de(e).some(s=>s&&(r?s===t:s.startsWith(t)||t.startsWith(s))),Fr=(e,t,r,s,u)=>u.isOnAll?!1:!r&&u.isOnTouch?!(t||e):(r?s.isOnBlur:u.isOnBlur)?!e:(r?s.isOnChange:u.isOnChange)?e:!0,Sr=(e,t)=>!qe(h(e,t)).length&&p(e,t),xr=(e,t,r)=>{const s=de(h(e,r));return D(s,"root",t[r]),D(e,r,s),e},me=e=>Z(e);function _t(e,t,r="validate"){if(me(e)||Array.isArray(e)&&e.every(me)||H(e)&&!e)return{type:r,message:me(e)?e:"",ref:t}}var oe=e=>k(e)&&!Ee(e)?e:{value:e,message:""},Et=async(e,t,r,s,u,o)=>{const{ref:a,refs:l,required:v,maxLength:w,minLength:m,min:S,max:b,pattern:ae,validate:J,name:I,valueAsNumber:Y,mount:De}=e._f,E=h(r,I);if(!De||t.has(I))return{};const K=l?l[0]:a,z=_=>{u&&K.reportValidity&&(K.setCustomValidity(H(_)?"":_||""),K.reportValidity())},P={},he=He(a),X=ye(a),Fe=he||X,U=(Y||$e(a))&&O(a.value)&&O(E)||we(a)&&a.value===""||E===""||Array.isArray(E)&&!E.length,re=We.bind(null,I,s,P),W=(_,A,x,T=Q.maxLength,B=Q.minLength)=>{const $=_?A:x;P[I]={type:_?T:B,message:$,ref:a,...re(_?T:B,$)}};if(o?!Array.isArray(E)||!E.length:v&&(!Fe&&(U||L(E))||H(E)&&!E||X&&!Pt(l).isValid||he&&!Tt(l).isValid)){const{value:_,message:A}=me(v)?{value:!!v,message:v}:oe(v);if(_&&(P[I]={type:Q.required,message:A,ref:K,...re(Q.required,A)},!s))return z(A),P}if(!U&&(!L(S)||!L(b))){let _,A;const x=oe(b),T=oe(S);if(!L(E)&&!isNaN(E)){const B=a.valueAsNumber||E&&+E;L(x.value)||(_=B>x.value),L(T.value)||(A=B<T.value)}else{const B=a.valueAsDate||new Date(E),$=ge=>new Date(new Date().toDateString()+" "+ge),ue=a.type=="time",ne=a.type=="week";Z(x.value)&&E&&(_=ue?$(E)>$(x.value):ne?E>x.value:B>new Date(x.value)),Z(T.value)&&E&&(A=ue?$(E)<$(T.value):ne?E<T.value:B<new Date(T.value))}if((_||A)&&(W(!!_,x.message,T.message,Q.max,Q.min),!s))return z(P[I].message),P}if((w||m)&&!U&&(Z(E)||o&&Array.isArray(E))){const _=oe(w),A=oe(m),x=!L(_.value)&&E.length>+_.value,T=!L(A.value)&&E.length<+A.value;if((x||T)&&(W(x,_.message,A.message),!s))return z(P[I].message),P}if(ae&&!U&&Z(E)){const{value:_,message:A}=oe(ae);if(Ee(_)&&!E.match(_)&&(P[I]={type:Q.pattern,message:A,ref:a,...re(Q.pattern,A)},!s))return z(A),P}if(J){if(q(J)){const _=await J(E,r),A=_t(_,K);if(A&&(P[I]={...A,...re(Q.validate,A.message)},!s))return z(A.message),P}else if(k(J)){let _={};for(const A in J){if(!M(_)&&!s)break;const x=_t(await J[A](E,r),K,A);x&&(_={...x,...re(A,x.message)},z(x.message),s&&(P[I]=_))}if(!M(_)&&(P[I]={ref:K,..._},!s))return P}}return z(!0),P};const kr={mode:R.onSubmit,reValidateMode:R.onChange,shouldFocusError:!0};function pr(e={}){let t={...kr,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:q(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},u=k(t.defaultValues)||k(t.values)?C(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:C(u),a={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,w=0;const m={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let S={...m};const b={array:dt(),state:dt()},ae=t.criteriaMode===R.all,J=i=>n=>{clearTimeout(w),w=setTimeout(i,n)},I=async i=>{if(!t.disabled&&(m.isValid||S.isValid||i)){const n=t.resolver?M((await X()).errors):await U(s,!0);n!==r.isValid&&b.state.next({isValid:n})}},Y=(i,n)=>{!t.disabled&&(m.isValidating||m.validatingFields||S.isValidating||S.validatingFields)&&((i||Array.from(l.mount)).forEach(c=>{c&&(n?D(r.validatingFields,c,n):p(r.validatingFields,c))}),b.state.next({validatingFields:r.validatingFields,isValidating:!M(r.validatingFields)}))},De=(i,n=[],c,y,f=!0,d=!0)=>{if(y&&c&&!t.disabled){if(a.action=!0,d&&Array.isArray(h(s,i))){const g=c(h(s,i),y.argA,y.argB);f&&D(s,i,g)}if(d&&Array.isArray(h(r.errors,i))){const g=c(h(r.errors,i),y.argA,y.argB);f&&D(r.errors,i,g),Sr(r.errors,i)}if((m.touchedFields||S.touchedFields)&&d&&Array.isArray(h(r.touchedFields,i))){const g=c(h(r.touchedFields,i),y.argA,y.argB);f&&D(r.touchedFields,i,g)}(m.dirtyFields||S.dirtyFields)&&(r.dirtyFields=ce(u,o)),b.state.next({name:i,isDirty:W(i,n),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else D(o,i,n)},E=(i,n)=>{D(r.errors,i,n),b.state.next({errors:r.errors})},K=i=>{r.errors=i,b.state.next({errors:r.errors,isValid:!1})},z=(i,n,c,y)=>{const f=h(s,i);if(f){const d=h(o,i,O(c)?h(u,i):c);O(d)||y&&y.defaultChecked||n?D(o,i,n?d:gt(f._f)):x(i,d),a.mount&&I()}},P=(i,n,c,y,f)=>{let d=!1,g=!1;const V={name:i};if(!t.disabled){if(!c||y){(m.isDirty||S.isDirty)&&(g=r.isDirty,r.isDirty=V.isDirty=W(),d=g!==V.isDirty);const F=te(h(u,i),n);g=!!h(r.dirtyFields,i),F?p(r.dirtyFields,i):D(r.dirtyFields,i,!0),V.dirtyFields=r.dirtyFields,d=d||(m.dirtyFields||S.dirtyFields)&&g!==!F}if(c){const F=h(r.touchedFields,i);F||(D(r.touchedFields,i,c),V.touchedFields=r.touchedFields,d=d||(m.touchedFields||S.touchedFields)&&F!==c)}d&&f&&b.state.next(V)}return d?V:{}},he=(i,n,c,y)=>{const f=h(r.errors,i),d=(m.isValid||S.isValid)&&H(n)&&r.isValid!==n;if(t.delayError&&c?(v=J(()=>E(i,c)),v(t.delayError)):(clearTimeout(w),v=null,c?D(r.errors,i,c):p(r.errors,i)),(c?!te(f,c):f)||!M(y)||d){const g={...y,...d&&H(n)?{isValid:n}:{},errors:r.errors,name:i};r={...r,...g},b.state.next(g)}},X=async i=>{Y(i,!0);const n=await t.resolver(o,t.context,_r(i||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return Y(i),n},Fe=async i=>{const{errors:n}=await X(i);if(i)for(const c of i){const y=h(n,c);y?D(r.errors,c,y):p(r.errors,c)}else r.errors=n;return n},U=async(i,n,c={valid:!0})=>{for(const y in i){const f=i[y];if(f){const{_f:d,...g}=f;if(d){const V=l.array.has(d.name),F=f._f&&Er(f._f);F&&m.validatingFields&&Y([y],!0);const N=await Et(f,l.disabled,o,ae,t.shouldUseNativeValidation&&!n,V);if(F&&m.validatingFields&&Y([y]),N[d.name]&&(c.valid=!1,n))break;!n&&(h(N,d.name)?V?xr(r.errors,N,d.name):D(r.errors,d.name,N[d.name]):p(r.errors,d.name))}!M(g)&&await U(g,n,c)}}return c.valid},re=()=>{for(const i of l.unMount){const n=h(s,i);n&&(n._f.refs?n._f.refs.every(c=>!Ce(c)):!Ce(n._f.ref))&&Se(i)}l.unMount=new Set},W=(i,n)=>!t.disabled&&(i&&n&&D(o,i,n),!te(ge(),u)),_=(i,n,c)=>vr(i,l,{...a.mount?o:O(n)?u:Z(i)?{[i]:n}:n},c,n),A=i=>qe(h(a.mount?o:u,i,t.shouldUnregister?h(u,i,[]):[])),x=(i,n,c={})=>{const y=h(s,i);let f=n;if(y){const d=y._f;d&&(!d.disabled&&D(o,i,Ct(n,d)),f=we(d.ref)&&L(n)?"":n,pt(d.ref)?[...d.ref.options].forEach(g=>g.selected=f.includes(g.value)):d.refs?ye(d.ref)?d.refs.forEach(g=>{(!g.defaultChecked||!g.disabled)&&(Array.isArray(f)?g.checked=!!f.find(V=>V===g.value):g.checked=f===g.value||!!f)}):d.refs.forEach(g=>g.checked=g.value===f):$e(d.ref)?d.ref.value="":(d.ref.value=f,d.ref.type||b.state.next({name:i,values:C(o)})))}(c.shouldDirty||c.shouldTouch)&&P(i,f,c.shouldTouch,c.shouldDirty,!0),c.shouldValidate&&ne(i)},T=(i,n,c)=>{for(const y in n){if(!n.hasOwnProperty(y))return;const f=n[y],d=i+"."+y,g=h(s,d);(l.array.has(i)||k(f)||g&&!g._f)&&!se(f)?T(d,f,c):x(d,f,c)}},B=(i,n,c={})=>{const y=h(s,i),f=l.array.has(i),d=C(n);D(o,i,d),f?(b.array.next({name:i,values:C(o)}),(m.isDirty||m.dirtyFields||S.isDirty||S.dirtyFields)&&c.shouldDirty&&b.state.next({name:i,dirtyFields:ce(u,o),isDirty:W(i,d)})):y&&!y._f&&!L(d)?T(i,d,c):x(i,d,c),mt(i,l)&&b.state.next({...r}),b.state.next({name:a.mount?i:void 0,values:C(o)})},$=async i=>{a.mount=!0;const n=i.target;let c=n.name,y=!0;const f=h(s,c),d=F=>{y=Number.isNaN(F)||se(F)&&isNaN(F.getTime())||te(F,h(o,c,F))},g=vt(t.mode),V=vt(t.reValidateMode);if(f){let F,N;const ve=n.type?gt(f._f):cr(i),G=i.type===lt.BLUR||i.type===lt.FOCUS_OUT,Kt=!Vr(f._f)&&!t.resolver&&!h(r.errors,c)&&!f._f.deps||Fr(G,h(r.touchedFields,c),r.isSubmitted,V,g),pe=mt(c,l,G);D(o,c,ve),G?(f._f.onBlur&&f._f.onBlur(i),v&&v(0)):f._f.onChange&&f._f.onChange(i);const Oe=P(c,ve,G),Qt=!M(Oe)||pe;if(!G&&b.state.next({name:c,type:i.type,values:C(o)}),Kt)return(m.isValid||S.isValid)&&(t.mode==="onBlur"?G&&I():G||I()),Qt&&b.state.next({name:c,...pe?{}:Oe});if(!G&&pe&&b.state.next({...r}),t.resolver){const{errors:tt}=await X([c]);if(d(ve),y){const Jt=wt(r.errors,s,c),rt=wt(tt,s,Jt.name||c);F=rt.error,c=rt.name,N=M(tt)}}else Y([c],!0),F=(await Et(f,l.disabled,o,ae,t.shouldUseNativeValidation))[c],Y([c]),d(ve),y&&(F?N=!1:(m.isValid||S.isValid)&&(N=await U(s,!0)));y&&(f._f.deps&&ne(f._f.deps),he(c,N,F,Oe))}},ue=(i,n)=>{if(h(r.errors,n)&&i.focus)return i.focus(),1},ne=async(i,n={})=>{let c,y;const f=de(i);if(t.resolver){const d=await Fe(O(i)?i:f);c=M(d),y=i?!f.some(g=>h(d,g)):c}else i?(y=(await Promise.all(f.map(async d=>{const g=h(s,d);return await U(g&&g._f?{[d]:g}:g)}))).every(Boolean),!(!y&&!r.isValid)&&I()):y=c=await U(s);return b.state.next({...!Z(i)||(m.isValid||S.isValid)&&c!==r.isValid?{}:{name:i},...t.resolver||!i?{isValid:c}:{},errors:r.errors}),n.shouldFocus&&!y&&fe(s,ue,i?f:l.mount),y},ge=i=>{const n={...a.mount?o:u};return O(i)?n:Z(i)?h(n,i):i.map(c=>h(n,c))},Ze=(i,n)=>({invalid:!!h((n||r).errors,i),isDirty:!!h((n||r).dirtyFields,i),error:h((n||r).errors,i),isValidating:!!h(r.validatingFields,i),isTouched:!!h((n||r).touchedFields,i)}),Rt=i=>{i&&de(i).forEach(n=>p(r.errors,n)),b.state.next({errors:i?r.errors:{}})},Ke=(i,n,c)=>{const y=(h(s,i,{_f:{}})._f||{}).ref,f=h(r.errors,i)||{},{ref:d,message:g,type:V,...F}=f;D(r.errors,i,{...F,...n,ref:y}),b.state.next({name:i,errors:r.errors,isValid:!1}),c&&c.shouldFocus&&y&&y.focus&&y.focus()},qt=(i,n)=>q(i)?b.state.subscribe({next:c=>i(_(void 0,n),c)}):_(i,n,!0),Qe=i=>b.state.subscribe({next:n=>{Dr(i.name,n.name,i.exact)&&Ar(n,i.formState||m,Zt,i.reRenderRoot)&&i.callback({values:{...o},...r,...n})}}).unsubscribe,zt=i=>(a.mount=!0,S={...S,...i.formState},Qe({...i,formState:S})),Se=(i,n={})=>{for(const c of i?de(i):l.mount)l.mount.delete(c),l.array.delete(c),n.keepValue||(p(s,c),p(o,c)),!n.keepError&&p(r.errors,c),!n.keepDirty&&p(r.dirtyFields,c),!n.keepTouched&&p(r.touchedFields,c),!n.keepIsValidating&&p(r.validatingFields,c),!t.shouldUnregister&&!n.keepDefaultValue&&p(u,c);b.state.next({values:C(o)}),b.state.next({...r,...n.keepDirty?{isDirty:W()}:{}}),!n.keepIsValid&&I()},Je=({disabled:i,name:n})=>{(H(i)&&a.mount||i||l.disabled.has(n))&&(i?l.disabled.add(n):l.disabled.delete(n))},xe=(i,n={})=>{let c=h(s,i);const y=H(n.disabled)||H(t.disabled);return D(s,i,{...c||{},_f:{...c&&c._f?c._f:{ref:{name:i}},name:i,mount:!0,...n}}),l.mount.add(i),c?Je({disabled:H(n.disabled)?n.disabled:t.disabled,name:i}):z(i,!0,n.value),{...y?{disabled:n.disabled||t.disabled}:{},...t.progressive?{required:!!n.required,min:le(n.min),max:le(n.max),minLength:le(n.minLength),maxLength:le(n.maxLength),pattern:le(n.pattern)}:{},name:i,onChange:$,onBlur:$,ref:f=>{if(f){xe(i,n),c=h(s,i);const d=O(f.value)&&f.querySelectorAll&&f.querySelectorAll("input,select,textarea")[0]||f,g=br(d),V=c._f.refs||[];if(g?V.find(F=>F===d):d===c._f.ref)return;D(s,i,{_f:{...c._f,...g?{refs:[...V.filter(Ce),d,...Array.isArray(h(u,i))?[{}]:[]],ref:{type:d.type,name:i}}:{ref:d}}}),z(i,!1,void 0,d)}else c=h(s,i,{}),c._f&&(c._f.mount=!1),(t.shouldUnregister||n.shouldUnregister)&&!(dr(l.array,i)&&a.action)&&l.unMount.add(i)}}},ke=()=>t.shouldFocusError&&fe(s,ue,l.mount),Wt=i=>{H(i)&&(b.state.next({disabled:i}),fe(s,(n,c)=>{const y=h(s,c);y&&(n.disabled=y._f.disabled||i,Array.isArray(y._f.refs)&&y._f.refs.forEach(f=>{f.disabled=y._f.disabled||i}))},0,!1))},Ye=(i,n)=>async c=>{let y;c&&(c.preventDefault&&c.preventDefault(),c.persist&&c.persist());let f=C(o);if(b.state.next({isSubmitting:!0}),t.resolver){const{errors:d,values:g}=await X();r.errors=d,f=C(g)}else await U(s);if(l.disabled.size)for(const d of l.disabled)p(f,d);if(p(r.errors,"root"),M(r.errors)){b.state.next({errors:{}});try{await i(f,c)}catch(d){y=d}}else n&&await n({...r.errors},c),ke(),setTimeout(ke);if(b.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:M(r.errors)&&!y,submitCount:r.submitCount+1,errors:r.errors}),y)throw y},$t=(i,n={})=>{h(s,i)&&(O(n.defaultValue)?B(i,C(h(u,i))):(B(i,n.defaultValue),D(u,i,C(n.defaultValue))),n.keepTouched||p(r.touchedFields,i),n.keepDirty||(p(r.dirtyFields,i),r.isDirty=n.defaultValue?W(i,C(h(u,i))):W()),n.keepError||(p(r.errors,i),m.isValid&&I()),b.state.next({...r}))},Xe=(i,n={})=>{const c=i?C(i):u,y=C(c),f=M(i),d=f?u:y;if(n.keepDefaultValues||(u=c),!n.keepValues){if(n.keepDirtyValues){const g=new Set([...l.mount,...Object.keys(ce(u,o))]);for(const V of Array.from(g))h(r.dirtyFields,V)?D(d,V,h(o,V)):B(V,h(d,V))}else{if(Re&&O(i))for(const g of l.mount){const V=h(s,g);if(V&&V._f){const F=Array.isArray(V._f.refs)?V._f.refs[0]:V._f.ref;if(we(F)){const N=F.closest("form");if(N){N.reset();break}}}}if(n.keepFieldsRef)for(const g of l.mount)B(g,h(d,g));else s={}}o=t.shouldUnregister?n.keepDefaultValues?C(u):{}:C(d),b.array.next({values:{...d}}),b.state.next({values:{...d}})}l={mount:n.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!m.isValid||!!n.keepIsValid||!!n.keepDirtyValues,a.watch=!!t.shouldUnregister,b.state.next({submitCount:n.keepSubmitCount?r.submitCount:0,isDirty:f?!1:n.keepDirty?r.isDirty:!!(n.keepDefaultValues&&!te(i,u)),isSubmitted:n.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:f?{}:n.keepDirtyValues?n.keepDefaultValues&&o?ce(u,o):r.dirtyFields:n.keepDefaultValues&&i?ce(u,i):n.keepDirty?r.dirtyFields:{},touchedFields:n.keepTouched?r.touchedFields:{},errors:n.keepErrors?r.errors:{},isSubmitSuccessful:n.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Ge=(i,n)=>Xe(q(i)?i(o):i,n),Ht=(i,n={})=>{const c=h(s,i),y=c&&c._f;if(y){const f=y.refs?y.refs[0]:y.ref;f.focus&&(f.focus(),n.shouldSelect&&q(f.select)&&f.select())}},Zt=i=>{r={...r,...i}},et={control:{register:xe,unregister:Se,getFieldState:Ze,handleSubmit:Ye,setError:Ke,_subscribe:Qe,_runSchema:X,_focusError:ke,_getWatch:_,_getDirty:W,_setValid:I,_setFieldArray:De,_setDisabledField:Je,_setErrors:K,_getFieldArray:A,_reset:Xe,_resetDefaultValues:()=>q(t.defaultValues)&&t.defaultValues().then(i=>{Ge(i,t.resetOptions),b.state.next({isLoading:!1})}),_removeUnmounted:re,_disableForm:Wt,_subjects:b,_proxyFormState:m,get _fields(){return s},get _formValues(){return o},get _state(){return a},set _state(i){a=i},get _defaultValues(){return u},get _names(){return l},set _names(i){l=i},get _formState(){return r},get _options(){return t},set _options(i){t={...t,...i}}},subscribe:zt,trigger:ne,register:xe,handleSubmit:Ye,watch:qt,setValue:B,getValues:ge,reset:Ge,resetField:$t,clearErrors:Rt,unregister:Se,setError:Ke,setFocus:Ht,getFieldState:Ze};return{...et,formControl:et}}function Wr(e={}){const t=j.useRef(void 0),r=j.useRef(void 0),[s,u]=j.useState({isDirty:!1,isValidating:!1,isLoading:q(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:q(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:s},e.defaultValues&&!q(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:a,...l}=pr(e);t.current={...l,formState:s}}const o=t.current.control;return o._options=e,gr(()=>{const a=o._subscribe({formState:o._proxyFormState,callback:()=>u({...o._formState}),reRenderRoot:!0});return u(l=>({...l,isReady:!0})),o._formState.isReady=!0,a},[o]),j.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),j.useEffect(()=>{e.mode&&(o._options.mode=e.mode),e.reValidateMode&&(o._options.reValidateMode=e.reValidateMode)},[o,e.mode,e.reValidateMode]),j.useEffect(()=>{e.errors&&(o._setErrors(e.errors),o._focusError())},[o,e.errors]),j.useEffect(()=>{e.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,e.shouldUnregister]),j.useEffect(()=>{if(o._proxyFormState.isDirty){const a=o._getDirty();a!==s.isDirty&&o._subjects.state.next({isDirty:a})}},[o,s.isDirty]),j.useEffect(()=>{e.values&&!te(e.values,r.current)?(o._reset(e.values,{keepFieldsRef:!0,...o._options.resetOptions}),r.current=e.values,u(a=>({...a}))):o._resetDefaultValues()},[o,e.values]),j.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),t.current.formState=hr(s,o),t.current}const Vt=(e,t,r)=>{if(e&&"reportValidity"in e){const s=h(r,t);e.setCustomValidity(s&&s.message||""),e.reportValidity()}},je=(e,t)=>{for(const r in t.fields){const s=t.fields[r];s&&s.ref&&"reportValidity"in s.ref?Vt(s.ref,r,e):s&&s.refs&&s.refs.forEach(u=>Vt(u,r,e))}},At=(e,t)=>{t.shouldUseNativeValidation&&je(e,t);const r={};for(const s in e){const u=h(t.fields,s),o=Object.assign(e[s]||{},{ref:u&&u.ref});if(Or(t.names||Object.keys(e),s)){const a=Object.assign({},h(r,s));D(a,"root",o),D(r,s,a)}else D(r,s,o)}return r},Or=(e,t)=>{const r=Dt(t);return e.some(s=>Dt(s).match(`^${r}\\.\\d+`))};function Dt(e){return e.replace(/\]|\[/g,"")}function Lt(e,t,r){function s(l,v){var w;Object.defineProperty(l,"_zod",{value:l._zod??{},enumerable:!1}),(w=l._zod).traits??(w.traits=new Set),l._zod.traits.add(e),t(l,v);for(const m in a.prototype)m in l||Object.defineProperty(l,m,{value:a.prototype[m].bind(l)});l._zod.constr=a,l._zod.def=v}const u=r?.Parent??Object;class o extends u{}Object.defineProperty(o,"name",{value:e});function a(l){var v;const w=r?.Parent?new o:this;s(w,l),(v=w._zod).deferred??(v.deferred=[]);for(const m of w._zod.deferred)m();return w}return Object.defineProperty(a,"init",{value:s}),Object.defineProperty(a,Symbol.hasInstance,{value:l=>r?.Parent&&l instanceof r.Parent?!0:l?._zod?.traits?.has(e)}),Object.defineProperty(a,"name",{value:e}),a}class Ir extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Pr={};function Bt(e){return Pr}function Cr(e,t){return typeof t=="bigint"?t.toString():t}const Mt=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function be(e){return typeof e=="string"?e:e?.message}function Nt(e,t,r){const s={...e,path:e.path??[]};if(!e.message){const u=be(e.inst?._zod.def?.error?.(e))??be(t?.error?.(e))??be(r.customError?.(e))??be(r.localeError?.(e))??"Invalid input";s.message=u}return delete s.inst,delete s.continue,t?.reportInput||delete s.input,s}const Ut=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Cr,2)},enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Tr=Lt("$ZodError",Ut),jt=Lt("$ZodError",Ut,{Parent:Error}),Lr=e=>(t,r,s,u)=>{const o=s?Object.assign(s,{async:!1}):{async:!1},a=t._zod.run({value:r,issues:[]},o);if(a instanceof Promise)throw new Ir;if(a.issues.length){const l=new(u?.Err??e)(a.issues.map(v=>Nt(v,o,Bt())));throw Mt(l,u?.callee),l}return a.value},Br=Lr(jt),Mr=e=>async(t,r,s,u)=>{const o=s?Object.assign(s,{async:!0}):{async:!0};let a=t._zod.run({value:r,issues:[]},o);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new(u?.Err??e)(a.issues.map(v=>Nt(v,o,Bt())));throw Mt(l,u?.callee),l}return a.value},Nr=Mr(jt);function Ft(e,t){try{var r=e()}catch(s){return t(s)}return r&&r.then?r.then(void 0,t):r}function Ur(e,t){for(var r={};e.length;){var s=e[0],u=s.code,o=s.message,a=s.path.join(".");if(!r[a])if("unionErrors"in s){var l=s.unionErrors[0].errors[0];r[a]={message:l.message,type:l.code}}else r[a]={message:o,type:u};if("unionErrors"in s&&s.unionErrors.forEach(function(m){return m.errors.forEach(function(S){return e.push(S)})}),t){var v=r[a].types,w=v&&v[s.code];r[a]=We(a,t,r,u,w?[].concat(w,s.message):s.message)}e.shift()}return r}function jr(e,t){for(var r={};e.length;){var s=e[0],u=s.code,o=s.message,a=s.path.join(".");if(!r[a])if(s.code==="invalid_union"){var l=s.errors[0][0];r[a]={message:l.message,type:l.code}}else r[a]={message:o,type:u};if(s.code==="invalid_union"&&s.errors.forEach(function(m){return m.forEach(function(S){return e.push(S)})}),t){var v=r[a].types,w=v&&v[s.code];r[a]=We(a,t,r,u,w?[].concat(w,s.message):s.message)}e.shift()}return r}function $r(e,t,r){if(r===void 0&&(r={}),function(s){return"_def"in s&&typeof s._def=="object"&&"typeName"in s._def}(e))return function(s,u,o){try{return Promise.resolve(Ft(function(){return Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](s,t)).then(function(a){return o.shouldUseNativeValidation&&je({},o),{errors:{},values:r.raw?Object.assign({},s):a}})},function(a){if(function(l){return Array.isArray(l?.issues)}(a))return{values:{},errors:At(Ur(a.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw a}))}catch(a){return Promise.reject(a)}};if(function(s){return"_zod"in s&&typeof s._zod=="object"}(e))return function(s,u,o){try{return Promise.resolve(Ft(function(){return Promise.resolve((r.mode==="sync"?Br:Nr)(e,s,t)).then(function(a){return o.shouldUseNativeValidation&&je({},o),{errors:{},values:r.raw?Object.assign({},s):a}})},function(a){if(function(l){return l instanceof Tr}(a))return{values:{},errors:At(jr(a.issues,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw a}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}class ee{constructor(t,r){this.value=t,this.error=r}static ok(t){return new ee(t,void 0)}static err(t){return new ee(void 0,t)}isOk(){return this.error===void 0}isErr(){return this.error!==void 0}unwrap(){if(this.isOk())return this.value;throw new Error(`Tried to unwrap an Err: ${this.error}`)}unwrapRaw(){if(this.isOk())return this.value;throw this.error}unwrapOr(t){return this.isOk()?this.value:t}unwrapErr(){if(this.isErr())return this.error;throw new Error(`Tried to unwrapErr an Ok: ${this.value}`)}map(t){return this.isOk()?ee.ok(t(this.value)):ee.err(this.error)}mapErr(t){return this.isErr()?ee.err(t(this.error)):ee.ok(this.value)}andThen(t){return this.isOk()?t(this.value):ee.err(this.error)}}class Hr extends Error{cause;constructor(t,r){super(t),this.name="DatabaseError",this.cause=r,r instanceof Error&&r.stack&&(this.stack+=`
Caused by: ${r.stack}`)}}class Zr extends Error{cause;constructor(t,r){super(t),this.name="UnknownError",this.cause=r,r instanceof Error&&r.stack&&(this.stack+=`
Caused by: ${r.stack}`)}}export{Hr as D,ee as R,Zr as U,$r as a,zr as i,Wr as u};
